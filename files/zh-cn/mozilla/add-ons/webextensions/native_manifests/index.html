---
title: 原生应用清单
slug: Mozilla/Add-ons/WebExtensions/Native_manifests
translation_of: Mozilla/Add-ons/WebExtensions/Native_manifests
---
<div><section class="Quick_links" id="Quick_Links">
  <ol>
    <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions"><strong>Browser extensions</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Getting started</summary>
        <ol>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions">What are extensions?</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension">Your first extension</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension">Your second extension</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension">Anatomy of an extension</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Examples">Example extensions</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/What_next_">What next?</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Concepts</summary>
        <ol>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs">Using the JavaScript APIs</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_scripts">Content scripts</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Match_patterns">Match patterns</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Working_with_files">Working with files</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Internationalization">Internationalization</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Security_best_practices">Security best practices</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy">Content Security Policy</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Native_messaging">Native messaging</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>User interface</summary>
        <ol>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface">User Interface</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action">Toolbar button</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions">Address bar button</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars">Sidebars</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items">Context menu items</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages">Options page</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages">Extension pages</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications">Notifications</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox">Address bar suggestions</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels">Developer tools panels</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>How to</summary>
        <ol>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests">Intercept HTTP requests</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page">Modify a web page</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page">Insert external content</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar">Add a button to the toolbar</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page">Implement a settings page</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API">Work with the Tabs API</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API">Work with the Bookmarks API</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API">Work with the Cookies API</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities">Work with contextual identities</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/onboarding_upboarding_offboarding_best_practices">Onboard, upboard, and offboard users</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Porting</summary>
        <ol>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators">Firefox differentiators</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Porting_a_Google_Chrome_extension">Porting a Google Chrome extension</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Porting_a_legacy_Firefox_add-on">Porting a legacy Firefox extension</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Embedded_WebExtensions">Embedded WebExtensions</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Comparison_with_the_Add-on_SDK">Comparison with the Add-on SDK</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Comparison_with_XUL_XPCOM_extensions">Comparison with XUL/XPCOM extensions</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations">Differences between API implementations</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities">Chrome incompatibilities</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Differences_between_desktop_and_Android">Differences between desktop and Android</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Firefox workflow</summary>
        <ol>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Development_Tools">Developer tools</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/User_experience_best_practices">User Experience</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Temporary_Installation_in_Firefox">Temporary Installation in Firefox</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Debugging">Debugging</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Testing_persistent_and_restart_features">Testing persistent and restart features</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Developing_WebExtensions_for_Firefox_for_Android">Developing for Firefox for Android</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Getting_started_with_web-ext">Getting started with web-ext</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/web-ext_command_reference">web-ext command reference</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/WebExtensions_and_the_Add-on_ID">Extensions and the Add-on ID</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Request_the_right_permissions">Request the right permissions</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>JavaScript APIs</summary>
        <ol><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs">Browser support for JavaScript APIs</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/alarms">alarms</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks">bookmarks</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/browserAction">browserAction</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/contextMenus">contextMenus</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/cookies">cookies</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/devtools.inspectedWindow">devtools.inspectedWindow</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/history">history</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime">runtime</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/storage">storage</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs">tabs</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation">webNavigation</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/webRequest">webRequest</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/windows">windows</a></li></ol>
      </details>
    </li>

    <li class="toggle">
      <details>
      <summary>Manifest keys</summary>
      <ol><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings">applications</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action">browser_action</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts">content_scripts</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale">default_locale</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer">developer</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version">manifest_version</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version">version</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/%E4%B8%BB%E9%A1%B5%E5%9C%B0%E5%9D%80">主页地址</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author">作者 - author</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name">名称 - name</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background">后台 - background</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description">描述 - description</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions">权限 - permissions</a></li><li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name">短名称 - short_name</a></li></ol>
      </details>
    </li>

    <li><a href="/zh-CN/docs/Mozilla/Add-ons/Themes"><strong>Themes</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Browser themes</summary>
        <ol>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/Themes/Theme_concepts">Browser theme concepts</a></li>
        </ol>
      </details>
    </li>
    <li><a href="/zh-CN/docs/Mozilla/Add-ons/Distribution"><strong>Publishing and Distribution</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Publishing add-ons</summary>
        <ol>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/Distribution">Signing and distribution overview</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Package_your_extension_">Package your extension</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/Distribution/Submitting_an_add-on">Submit an add-on</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/Source_Code_Submission">Source code submission</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/Distribution/Resources_for_publishers">Resources for publishers</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/Listing">Creating an appealing listing</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/Distribution/Make_money_from_browser_extensions">Make money from browser extensions</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/Distribution/Promoting_your_extension_or_theme">Promoting your extension or theme</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/AMO/Policy/Reviews">Review policies</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/AMO/Policy/Agreement">Developer agreement</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/AMO/Policy/Featured">Featured add-ons</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/Distribution/Retiring_your_extension">Retiring your extension</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Distributing add-ons</summary>
        <ol>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Sideloading_add-ons">For sideloading</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Add-ons_for_desktop_apps">For desktop apps</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Add-ons_in_the_enterprise">For an enterprise</a></li>
        </ol>
      </details>
    </li>
    <li><a href="https://discourse.mozilla.org/c/add-ons"><strong>Community and Support</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Channels</summary>
        <ol>
          <li><a href="https://blog.mozilla.org/addons">Add-ons blog</a></li>
          <li><a href="https://discourse.mozilla.org/c/add-ons">Add-on forums</a></li>
          <li><a href="http://stackoverflow.com/questions/tagged/firefox-addon">Stack Overflow</a></li>
          <li><a href="/zh-CN/docs/Mozilla/Add-ons/#Contact_us">Contact us</a></li>
        </ol>
      </details>
    </li>
  </ol>
</section></div>

<p> </p>

<p>原生应用清单是一个符合特定规则的JSON文件，它应该使用与 extension 不同的安装方式存放在用户的计算机上。举个例子，原生应用清单是由设备管理员或者通过原生应用安装器提供的。</p>

<p>有三种不同的原生应用清单：</p>

<table class="standard-table">
 <tbody>
  <tr>
   <td style="width: 40%;"><a href="#原生应用通信清单">原生应用通信清单</a></td>
   <td>
    <p>定义关于 <a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Native_messaging">与本地应用通信</a> 的功能：哪一个 extension 可以与本机的原生应用交换信息。</p>
   </td>
  </tr>
  <tr>
   <td><a href="#存储管理清单">存储管理清单</a></td>
   <td>
    <p>定义一些 extension 可以用 <a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/storage/managed"><code>storage.managed</code></a> 读取的只读数据。</p>
   </td>
  </tr>
  <tr>
   <td><a href="#PKCS #11 清单">PKCS #11 清单</a></td>
   <td>
    <p>定义了 extension 使用 <a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/pkcs11"><code>pkcs11</code></a> API 去枚举 PKCS #11 安全模型 并在Firefox安装它们。</p>
   </td>
  </tr>
 </tbody>
</table>

<p>对于所有的原生应用清单，你需要做一些工作以便于浏览器可以找到它们。这些规则在 <a href="#清单路径">清单路径</a><a href="#Manifest_location"> </a>章节。</p>

<h2 id="原生应用通信清单_2">原生应用通信清单<a id="原生应用通信清单" name="原生应用通信清单"></a></h2>

<p>原生应用通信清单中包含单个JSON对象，对象具有如下属性：</p>

<table class="fullwidth-table standard-table">
 <thead>
  <tr>
   <th scope="col">Name</th>
   <th scope="col">Type</th>
   <th scope="col">Description</th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td><code>name</code></td>
   <td>String</td>
   <td>
    <p>原生应用的名字</p>

    <p>它必须与 extension 调用 <a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime/connectNative"><code>runtime.connectNative()</code></a> 和 <a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendNativeMessage"><code>runtime.sendNativeMessage()</code></a> 时传入的名称保持一致。</p>

    <p>在 OS X 和 Linux 中，它必须和清单文件的文件名保持一致（除.json文件扩展名外）。</p>

    <p>在 Windows 中，它必须和你创建的包含原生应用清单路径的注册表一致。</p>

    <p>它必须符合正则表达式  &quot;^\w+(\.\w+)*$&quot;。这意味着它只能包含小写字母、数字、下划线和 <code>.</code> ，并且不允许开头或结束是 <code>.</code> ，并且 <code>.</code> 后面不能是 <code>.</code> 。</p>
   </td>
  </tr>
  <tr>
   <td><code>description</code></td>
   <td>String</td>
   <td>
    <p>关于这个原生应用的描述。</p>
   </td>
  </tr>
  <tr>
   <td><code>path</code></td>
   <td>String</td>
   <td>
    <p>到原生应用的路径。</p>

    <p>在 Windows 中，这可以是一个相对路径。在 OS X 和 Linux 中，必须是绝对路径。</p>
   </td>
  </tr>
  <tr>
   <td><code>type</code></td>
   <td>String</td>
   <td>
    <p>定义 extension 和原生应用的连接方法。</p>

    <p>目前只支持一种值，那就是 stdio。该值表示应用使用标准输入（stdin）来接受消息，用标准输出（stdout）来发送消息。</p>
   </td>
  </tr>
  <tr>
   <td><code>allowed_extensions</code></td>
   <td>Array of String</td>
   <td>
    <p>由 <a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/WebExtensions_and_the_Add-on_ID">Add-on ID</a> 组成的数组。每个值代表允许ID为该值的 extension 与这个原生应用通信。</p>

    <div class="note">
    <p>这意味着你可能需要在你 extension 的 manifest.json 中包含 <a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/applications">applications</a> 字段，并为 extension 设置一个显示的ID，哪怕是在开发时</p>
    </div>
   </td>
  </tr>
 </tbody>
</table>

<p>举个例子，这是 ping_pong 原生应用的原生应用通信清单：</p>

<pre class="brush: json">{
  &quot;name&quot;: &quot;ping_pong&quot;,
  &quot;description&quot;: &quot;Example host for native messaging&quot;,
  &quot;path&quot;: &quot;/path/to/native-messaging/app/ping_pong.py&quot;,
  &quot;type&quot;: &quot;stdio&quot;,
  &quot;allowed_extensions&quot;: [ &quot;ping_pong@example.org&quot; ]
}</pre>

<p>清单表示：它允许ID为 ping_pong@example.org 的 extension 通过传入 ping_pong 给 <a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/runtime" title="该模块提供关于附加组件以及运行环境的信息。"><code>runtime</code></a> 与自己连接。原生应用自身在 /path/to/native-messaging/app/ping_pong.py 中。</p>

<h2 id="存储管理清单_2">存储管理清单<a id="存储管理清单" name="存储管理清单"></a></h2>

<p>存储管理清单中包含单个JSON对象，对象具有如下属性：</p>

<table class="fullwidth-table standard-table">
 <thead>
  <tr>
   <th scope="col">Name</th>
   <th scope="col">Type</th>
   <th scope="col">Description</th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td><code>name</code></td>
   <td>String</td>
   <td>
    <p><strong>一个</strong> extension 的 ID，表示这个 extension 可以读取这个仓库。</p>

    <p>给出这个ID需要你的 extension 的 manifest.json 文件包含 <a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/applications">applications</a> 字段。</p>
   </td>
  </tr>
  <tr>
   <td><code>description</code></td>
   <td>String</td>
   <td>
    <p>人类可读的描述，Firefox会忽略它。</p>
   </td>
  </tr>
  <tr>
   <td><code>type</code></td>
   <td>String</td>
   <td>
    <p>该值只能是<code>storage</code>。</p>
   </td>
  </tr>
  <tr>
   <td><code>data</code></td>
   <td>Object</td>
   <td>
    <p>一个JSON对象，其中可以包含任何合法的JSON值（string、number、boolean、array、object），他们将成为<code>browser.storage.managed</code>可访问的数据。</p>
   </td>
  </tr>
 </tbody>
</table>

<p>举个例子：</p>

<pre class="brush: json line-numbers  language-json"><code class="language-json"><span class="punctuation token">{</span>
  <span class="key token">&quot;name&quot;:</span> <span class="string token">&quot;favourite-colour-examples@mozilla.org&quot;</span><span class="punctuation token">,</span>
  <span class="key token">&quot;description&quot;:</span> <span class="string token">&quot;ignored&quot;</span><span class="punctuation token">,</span>
  <span class="key token">&quot;type&quot;:</span> <span class="string token">&quot;storage&quot;</span><span class="punctuation token">,</span>
  <span class="key token">&quot;data&quot;:</span>
  <span class="punctuation token">{</span>
    <span class="key token">&quot;colour&quot;:</span> <span class="string token">&quot;management thinks it should be blue!&quot;</span>
  <span class="punctuation token">}</span>
<span class="punctuation token">}</span></code></pre>

<p>在给出的清单文件中，ID 为 favourite-colour-examples@mozilla.org 的 extension 有权限使用清单中的 data 字段中的数据，代码如下：</p>

<pre class="brush: js line-numbers  language-js"><code class="language-js"><span class="keyword token">var</span> storageItem <span class="operator token">=</span> browser<span class="punctuation token">.</span>storage<span class="punctuation token">.</span>managed<span class="punctuation token">.</span><span class="keyword token">get</span><span class="punctuation token">(</span><span class="string token">&apos;colour&apos;</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
storageItem<span class="punctuation token">.</span><span class="function token">then</span><span class="punctuation token">(</span><span class="punctuation token">(</span>res<span class="punctuation token">)</span> <span class="operator token">=</span><span class="operator token">&gt;</span> <span class="punctuation token">{</span>
  console<span class="punctuation token">.</span><span class="function token">log</span><span class="punctuation token">(</span><span class="template-string token"><span class="string token">`Managed colour is: </span><span class="interpolation token"><span class="interpolation-punctuation punctuation token">${</span>res<span class="punctuation token">.</span>colour<span class="interpolation-punctuation punctuation token">}</span></span><span class="string token">`</span></span><span class="punctuation token">)</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span></code></pre>

<h2 id="PKCS_11_清单">PKCS #11 清单<a id="PKCS #11 清单" name="PKCS #11 清单"></a></h2>

<p>PKCS #11 清单中包含单个JSON对象，对象具有如下属性：</p>

<table class="fullwidth-table standard-table">
 <thead>
  <tr>
   <th scope="col">Name</th>
   <th scope="col">Type</th>
   <th scope="col">Description</th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td><code>name</code></td>
   <td>String</td>
   <td>
    <p>PKCS #11 模块的名字。</p>

    <p>它必须和你使用 <code>pkcs11</code> API 时的名字一致。</p>

    <p>在 OS X 和 Linux 中，它必须和清单文件的文件名保持一致（除文件扩展名外）</p>

    <p>在 Windows 中，它必须和你创建的包含原生应用清单路径的注册表一致。</p>

    <p>它必须符合正则表达式  &quot;^\w+(\.\w+)*$&quot;。这意味着它只能包含小写字母、数字、下划线和 <code>.</code> ，并且不允许开头或结束是 <code>.</code> ，并且 <code>.</code> 后面不能是 <code>.</code> 。</p>
   </td>
  </tr>
  <tr>
   <td><code>description</code></td>
   <td>String</td>
   <td>
    <p>关于该模块的描述。</p>

    <p>它将被用在浏览器界面中为模块设置一个友好的名字（比如，在Firefox的“安全设备”对话框中）</p>
   </td>
  </tr>
  <tr>
   <td><code>path</code></td>
   <td>String</td>
   <td>
    <p>到模块的路径。</p>

    <p>在 Windows 中，这可以是一个相对路径。在 OS X 和 Linux 中，必须是绝对路径。</p>
   </td>
  </tr>
  <tr>
   <td><code>type</code></td>
   <td>String</td>
   <td>该值只能是<code>pkcs11</code>。 This must be &quot;pkcs11&quot;.</td>
  </tr>
  <tr>
   <td><code>allowed_extensions</code></td>
   <td>Array of String</td>
   <td>
    <p>由 <a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions/WebExtensions_and_the_Add-on_ID">Add-on ID</a> 组成的数组。每个值代表允许ID为该值的 extension 与这个模块通信。</p>

    <div class="note">
    <p>这意味着你可能需要在你 extension 的 manifest.json 中包含 <a href="/zh-CN/docs/Mozilla/Add-ons/WebExtensions/manifest.json/applications">applications</a> 字段，并为 extension 设置一个显示的ID，哪怕是在开发时</p>
    </div>
   </td>
  </tr>
 </tbody>
</table>

<p>举个例子：</p>

<pre class="brush: json line-numbers  language-json">{
  &quot;name&quot;: &quot;my_module&quot;,
  &quot;description&quot;: &quot;My test module&quot;,
  &quot;type&quot;: &quot;pkcs11&quot;,
  &quot;path&quot;: &quot;/path/to/libpkcs11testmodule.dylib&quot;,
  &quot;allowed_extensions&quot;: [&quot;my-extension@mozilla.org&quot;]
}</pre>

<p>给出的这个JSON清单，保存为 my_module.json，ID为 my-extension@mozilla.org 的 extension 就能够使用类似于如下代码安装 /path/to/libpkcs11testmodule.dylib 安全模块：</p>

<pre class="brush: js line-numbers  language-js">browser.pkcs11.installModule(&quot;my_module&quot;);</pre>

<h2 id="清单路径_2">清单路径<a id="清单路径" name="清单路径"></a></h2>

<p>在 Linux 和 Mac OS X 中，你需要将清单文件存在特定的位置。在 Windows 中，你需要创建一个注册表来指向清单文件。</p>

<p>所有类型的清单的详细规则都是相同的，除了倒数第二个的 type 字段表示了清单的类型。下面的例子展示了三种不同类型的清单。在例子中，&lt;name&gt; 代表清单中的 name 字段值。</p>

<h3 id="Windows">Windows</h3>

<p>如果想要全局可见，使用下面的路径创建注册表：</p>

<pre>HKEY_LOCAL_MACHINE\SOFTWARE\Mozilla\NativeMessagingHosts\&lt;name&gt;

HKEY_LOCAL_MACHINE\SOFTWARE\Mozilla\<code class="language-html">ManagedStorage</code>\&lt;name&gt;

HKEY_LOCAL_MACHINE\SOFTWARE\Mozilla\PKCS11Modules\&lt;name&gt;</pre>

<p>注册表应该有单个默认值，值里存放“到清单文件的路径”。比如为原生应用通信清单建立的注册表差不多是这样：</p>

<p><img src="https://mdn.mozillademos.org/files/15643/native-message-regkey-exaple.png" alt="为原生应用通信清单建立的注册表" style="height: 308px; width: 1027px;"></p>

<div class="note">
<p><em>对于原生应用清单，即使原生应用是32位的，也不能在 <a href="https://en.wikipedia.org/wiki/WoW64#Registry_and_file_system">Wow6432Node</a> 下创建注册表。浏览器将总会在 native 视图下寻找注册表的，而不是32位放在环境。确保注册表的创建在原生视图中，你可以键入KEY_WOW64_64KEY 或 KEY_WOW64_32KEY  到 RegCreateKeyEx。请参考：<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa384129(v=vs.85).aspx">Accessing an Alternate Registry View</a></em></p>
</div>

<p>如果想要用户级别的可见，使用下面的路径创建注册表：</p>

<pre>HKEY_CURRENT_USER\SOFTWARE\Mozilla\NativeMessagingHosts\&lt;name&gt;

HKEY_CURRENT_USER\SOFTWARE\Mozilla\<code class="language-html">ManagedStorage</code>\&lt;name&gt;

HKEY_CURRENT_USER\SOFTWARE\Mozilla\PKCS11Modules\&lt;name&gt;</pre>

<p>注册表应该有单个默认值，值里存放“到清单文件的路径”。</p>

<h3 id="Mac_OS_X">Mac OS X</h3>

<p>如果想要全局可见，将清单文件存放在：</p>

<pre>/Library/Application Support/Mozilla/NativeMessagingHosts/&lt;name&gt;.json

/Library/Application Support/Mozilla/<code class="language-html">ManagedStorage</code>/&lt;name&gt;.json

/Library/Application Support/Mozilla/PKCS11Modules/&lt;name&gt;.json</pre>

<p>如果想要用户级别的可见，将清单文件存放在：</p>

<pre>~/Library/Application Support/Mozilla/NativeMessagingHosts/&lt;name&gt;.json

~/Library/Application Support/Mozilla/<code class="language-html">ManagedStorage</code>/&lt;name&gt;.json

~/Library/Application Support/Mozilla/PKCS11Modules/&lt;name&gt;.json
</pre>

<h3 id="Linux">Linux</h3>

<p>如果想要全局可见，将清单文件存放在：</p>

<pre>/usr/lib/mozilla/native-messaging-hosts/&lt;name&gt;.json

/usr/lib/mozilla/<code class="language-html">managed-storage</code>/&lt;name&gt;.json

/usr/lib/mozilla/pkcs11-modules/&lt;name&gt;.json
</pre>

<p>或者：</p>

<pre>/usr/lib64/mozilla/native-messaging-hosts/&lt;name&gt;.json

/usr/lib64/mozilla/<code class="language-html">managed-storage</code>/&lt;name&gt;.json

/usr/lib64/mozilla/pkcs11-modules/&lt;name&gt;.json</pre>

<p>如果想要用户级别的可见，将清单文件存放在：</p>

<pre>~/.mozilla/native-messaging-hosts/&lt;name&gt;.json

~/.mozilla/<code class="language-html">managed-storage</code>/&lt;name&gt;.json

~/.mozilla/pkcs11-modules/&lt;name&gt;.json</pre>

<p> </p>

<p> </p>
