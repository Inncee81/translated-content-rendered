---
title: ExtendableEvent
slug: Web/API/ExtendableEvent
tags:
  - API
  - Experimental
  - ExtendableEvent
  - Interface
  - NeedsTranslation
  - Offline
  - Reference
  - Service Workers
  - ServiceWorker
  - TopicStub
  - Workers
translation_of: Web/API/ExtendableEvent
---
<div><section class="Quick_links" id="Quick_Links"><ol><li><strong><a href="/zh-CN/docs/Web/API/Service_Worker_API">Service Worker API</a></strong></li><li><strong><a href="/zh-CN/docs/Web/API/ExtendableEvent"><code>ExtendableEvent</code></a></strong></li><li class="toggle"><details open><summary>Constructor</summary><ol><li><span class="sidebar-icon"><span title="这是一个实验性的 API，请尽量不要在生产环境中使用它。"><i class="icon-beaker"> </i></span></span><a href="/zh-CN/docs/Web/API/ExtendableEvent/ExtendableEvent"><code>ExtendableEvent()</code></a> <a href="/zh-CN/docs/Web/API/ExtendableEvent/ExtendableEvent$translate" style="opacity: 0.5;">[我来译!]</a></li></ol></details></li><li class="toggle"><details open><summary>方法</summary><ol><li><a href="/zh-CN/docs/Web/API/ExtendableEvent/waitUntil"><code>waitUntil()</code></a></li></ol></details></li><li class="toggle"><details open><summary>继承</summary><ol><li><a href="/zh-CN/docs/Web/API/Event"><code>Event</code></a></li></ol></details></li><li class="toggle"><details open><summary>Related pages for Service Workers API</summary><ol><li><a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a></li><li><a href="/zh-CN/docs/Web/API/CacheStorage"><code>CacheStorage</code></a></li><li><a href="/zh-CN/docs/Web/API/Client"><code>Client</code></a></li><li><a href="/zh-CN/docs/Web/API/Clients"><code>Clients</code></a></li><li><a href="/zh-CN/docs/Web/API/FetchEvent"><code>FetchEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/InstallEvent"><code>InstallEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/Navigator/serviceWorker"><code>Navigator.serviceWorker</code></a></li><li><a href="/zh-CN/docs/Web/API/NotificationEvent"><code>NotificationEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/PeriodicSyncEvent"><code>PeriodicSyncEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/PeriodicSyncManager"><code>PeriodicSyncManager</code></a></li><li><a href="/zh-CN/docs/Web/API/PeriodicSyncRegistration"><code>PeriodicSyncRegistration</code></a></li><li><a href="/zh-CN/docs/Web/API/ServiceWorker"><code>ServiceWorker</code></a></li><li><a href="/zh-CN/docs/Web/API/ServiceWorkerContainer"><code>ServiceWorkerContainer</code></a></li><li><a href="/zh-CN/docs/Web/API/ServiceWorkerGlobalScope"><code>ServiceWorkerGlobalScope</code></a></li><li><a href="/zh-CN/docs/Web/API/ServiceWorkerRegistration"><code>ServiceWorkerRegistration</code></a></li><li><a href="/zh-CN/docs/Web/API/SyncEvent"><code>SyncEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/SyncManager"><code>SyncManager</code></a></li><li><a href="/zh-CN/docs/Web/API/SyncRegistration"><code>SyncRegistration</code></a></li><li><a href="/zh-CN/docs/Web/API/WindowClient"><code>WindowClient</code></a></li></ol></details></li></ol></section><div class="experimental indicator-warning notecard">
    <p><span title="这是一个实验性的 API，请尽量不要在生产环境中使用它。"><i class="icon-beaker"> </i></span> <strong>这是一个实验中的功能</strong><br>此功能某些浏览器尚在开发中，请参考<a href="#Browser_compatibility">浏览器兼容性表格</a>以得到在不同浏览器中适合使用的前缀。由于该功能对应的标准文档可能被重新修订，所以在未来版本的浏览器中该功能的语法和行为可能随之改变。</p>
</div></div>

<div>作为 service worker 生命周期的一部分，<strong><code>ExtendableEvent</code></strong>接口延长了在全局范围上<code><a href="/zh-CN/docs/Web/Reference/Events/install" title="/zh-CN/docs/Web/Reference/Events/install">install</a></code>和<code><a href="/zh-CN/docs/Web/Reference/Events/activate" title="/zh-CN/docs/Web/Reference/Events/activate">activate</a></code>事件的生命周期。这样可以确保在升级数据库架构并删除过时的caches之前，不会调度任何函数事件（如<a href="/zh-CN/docs/Web/API/FetchEvent" title="使用ServiceWorker技术时,页面的提取动作会在ServiceWorker作用域(ServiceWorkerGlobalScope)中触发fetch事件."><code>FetchEvent</code></a>）。</div>

<div>如果在<code>ExtendableEvent</code>处理程序之外调用<a href="/zh-CN/docs/Web/API/ExtendableEvent/waitUntil" title="ExtendableEvent.waitUntil() 方法扩展了事件的生命周期。在服务工作线程中，延长事件的寿命从而阻止浏览器在事件中的异步操作完成之前终止服务工作线程。"><code>waitUntil()</code></a>，浏览器应该抛出一个<code>InvalidStateError</code>；还要注意，多个调用将堆积起来，结果promises 将添加到<a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html#dfn-extend-lifetime-promises">extend lifetime promises</a>.</div>

<div> </div>

<div class="note notecard">
<p><strong>提示</strong>: 上述段落中描述的行为在firefox 43中得到了修复（参见 <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1189644" title="FIXED: &quot;Harness status: Timeout&quot; when running &quot;extendable-event-waituntil.https.html&quot; test">bug 1189644</a> ）。</p>
</div>

<p>此接口继承自<a href="/zh-CN/docs/Web/API/Event" title="此页面仍未被本地化, 期待您的翻译!"><code>Event</code></a>接口。</p>

<p></p><div class="hidden" id="inheritance_diagram">

<pre class="brush: html">  &lt;div id=&quot;interfaceDiagram&quot; style=&quot;display: inline-block; position: relative; width: 100%; padding-bottom: 8.571428571428571%; vertical-align: middle; overflow: hidden;&quot;&gt;&lt;svg style=&quot;display: inline-block; position: absolute; top: 0; left: 0;&quot; viewbox=&quot;-20 0 700 60&quot; preserveAspectRatio=&quot;xMinYMin meet&quot;&gt;&lt;a xlink:href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/API/Event&quot; target=&quot;_top&quot;&gt;&lt;rect x=&quot;1&quot; y=&quot;1&quot; width=&quot;75&quot; height=&quot;50&quot; fill=&quot;#fff&quot; stroke=&quot;#D4DDE4&quot; stroke-width=&quot;2px&quot; /&gt;&lt;text  x=&quot;38.5&quot; y=&quot;30&quot; font-size=&quot;12px&quot; font-family=&quot;Consolas,Monaco,Andale Mono,monospace&quot; fill=&quot;#4D4E53&quot; text-anchor=&quot;middle&quot; alignment-baseline=&quot;middle&quot;&gt;Event&lt;/text&gt;&lt;/a&gt;&lt;polyline points=&quot;76,25  86,20  86,30  76,25&quot; stroke=&quot;#D4DDE4&quot; fill=&quot;none&quot;/&gt;&lt;line x1=&quot;86&quot; y1=&quot;25&quot; x2=&quot;116&quot; y2=&quot;25&quot; stroke=&quot;#D4DDE4&quot;/&gt;&lt;a xlink:href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/API/ExtendableEvent&quot; target=&quot;_top&quot;&gt;&lt;rect x=&quot;116&quot; y=&quot;1&quot; width=&quot;150&quot; height=&quot;50&quot; fill=&quot;#F4F7F8&quot; stroke=&quot;#D4DDE4&quot; stroke-width=&quot;2px&quot; /&gt;&lt;text  x=&quot;191&quot; y=&quot;30&quot; font-size=&quot;12px&quot; font-family=&quot;Consolas,Monaco,Andale Mono,monospace&quot; fill=&quot;#4D4E53&quot; text-anchor=&quot;middle&quot; alignment-baseline=&quot;middle&quot;&gt;ExtendableEvent&lt;/text&gt;&lt;/a&gt;&lt;/svg&gt;&lt;/div&gt;
</pre>

<pre class="brush: css">  a:hover text { fill: #0095DD; pointer-events: all;}
</pre>

</div>

<iframe class="live-sample-frame inheritance-diagram-frame" frameborder="0" height="60" id="frame_inheritance_diagram" src="https://mdn.mozillademos.org/zh-CN/docs/Web/API/ExtendableEvent$samples/inheritance_diagram?revision=1554370" width="700"></iframe><p></p>

<div class="note notecard">
<p><strong>提示</strong>: 只有当全局范围是 <a href="/zh-CN/docs/Web/API/ServiceWorkerGlobalScope" title="The ServiceWorkerGlobalScope interface of the ServiceWorker API represents the global execution context of a service worker."><code>ServiceWorkerGlobalScope</code></a> 时，此接口才可用。当它是一个 <a href="/zh-CN/docs/Web/API/Window" title="The window object represents a window containing a DOM document; the document property points to the DOM document loaded in that window."><code>Window</code></a> 或其他类型 worker 的作用域时，它不可用。</p>
</div>

<h2 id="构造函数">构造函数</h2>

<dl>
 <dt><a href="/zh-CN/docs/Web/API/ExtendableEvent/ExtendableEvent" title="此页面仍未被本地化, 期待您的翻译!"><code>ExtendableEvent()</code></a></dt>
 <dd>创建新的<code>ExtendableEvent</code>对象。</dd>
</dl>

<h2 id="特性">特性</h2>

<p>不实现任何特定属性，但从其父级事件继承属，<em><a href="/zh-CN/docs/Web/API/Event" title="此页面仍未被本地化, 期待您的翻译!"><code>Event</code></a></em>。</p>

<h2 id="方法">方法</h2>

<p><em>从他的父辈继承, </em><em><a href="/zh-CN/docs/Web/API/Event" title="此页面仍未被本地化, 期待您的翻译!"><code>Event</code></a></em>.</p>

<dl>
 <dt><a href="/zh-CN/docs/Web/API/ExtendableEvent/waitUntil" title="ExtendableEvent.waitUntil() 方法扩展了事件的生命周期。在服务工作线程中，延长事件的寿命从而阻止浏览器在事件中的异步操作完成之前终止服务工作线程。"><code>ExtendableEvent.waitUntil()</code></a></dt>
 <dd>
 <p>延长事件的生存期。它将在service worker 的 <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/install">install</a></code> 和 <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/activate">activate</a></code> 事件中被调用。</p>
 </dd>
</dl>

<h2 id="实例">实例</h2>

<p>代码片段来自<a href="https://github.com/GoogleChrome/samples/blob/gh-pages/service-worker/prefetch/service-worker.js">service worker prefetch sample</a> (查看 <a href="https://googlechrome.github.io/samples/service-worker/prefetch/">prefetch example live</a>.)。代码在<a href="/zh-CN/docs/Web/API/ServiceWorkerGlobalScope/oninstall" title="此页面仍未被本地化, 期待您的翻译!"><code>ServiceWorkerGlobalScope.oninstall</code></a>中调用<a href="/zh-CN/docs/Web/API/ExtendableEvent/waitUntil" title="ExtendableEvent.waitUntil() 方法扩展了事件的生命周期。在服务工作线程中，延长事件的寿命从而阻止浏览器在事件中的异步操作完成之前终止服务工作线程。"><code>ExtendableEvent.waitUntil()</code></a>，延迟将<a href="/zh-CN/docs/Web/API/ServiceWorkerRegistration/installing" title="此页面仍未被本地化, 期待您的翻译!"><code>ServiceWorkerRegistration.installing</code></a> Worker视为已安装，直到传递的promise resolve(在所有资源都已被提取和缓存的情况，或者发生任何异常时的问题.)</p>

<p>代码段还显示了对service worker使用的缓存进行版本控制的最佳实践。虽然在这个例子中只有一个缓存，但是相同的方法可以用于多个缓存。它将缓存的速记标识符映射到特定的、版本化的缓存名称。</p>

<div class="note notecard">
<p><strong>提示</strong>:在chrome中，日志记录语句通过chrome://service worker internals访问的相关服务工作者的“inspect”接口可见。</p>
</div>

<pre class="brush: js">var CACHE_VERSION = 1;
var CURRENT_CACHES = {
  prefetch: &apos;prefetch-cache-v&apos; + CACHE_VERSION
};

self.addEventListener(&apos;install&apos;, function(event) {
  var urlsToPrefetch = [
    &apos;./static/pre_fetched.txt&apos;,
    &apos;./static/pre_fetched.html&apos;,
    &apos;https://www.chromium.org/_/rsrc/1302286216006/config/customLogo.gif&apos;
  ];

  console.log(&apos;Handling install event. Resources to pre-fetch:&apos;, urlsToPrefetch);

  event.waitUntil(
    caches.open(CURRENT_CACHES[&apos;prefetch&apos;]).then(function(cache) {
      cache.addAll(urlsToPrefetch.map(function(urlToPrefetch) {
        return new Request(urlToPrefetch, {mode: &apos;no-cors&apos;});
      })).then(function() {
        console.log(&apos;All resources have been fetched and cached.&apos;);
      });
    }).catch(function(error) {
      console.error(&apos;Pre-fetching failed:&apos;, error);
    })
  );
});</pre>

<div class="note notecard"><strong>重点</strong>: 在获取资源时，如果有可能资源是由不支持 <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> 的服务器提供的，那么使用 <code>{mode: &apos;no-cors&apos;}</code> 非常重要。在本例中， <a href="http://www.chromium.org">www.chromium.org</a> 不支持CORS。</div>

<h2 id="Specifications">Specifications</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <th scope="col">Specification</th>
   <th scope="col">Status</th>
   <th scope="col">Comment</th>
  </tr>
  <tr>
   <td><a class="external" href="https://w3c.github.io/ServiceWorker/#extendable-event" hreflang="en" lang="en">Service Workers<br><small lang="zh-CN">ExtendableEvent</small></a></td>
   <td><span class="spec-WD">Working Draft</span></td>
   <td>Initial definition.</td>
  </tr>
 </tbody>
</table>

<h2 id="Browser_compatibility">Browser compatibility</h2>

<div><div class="warning notecard"><strong><a href="https://github.com/mdn/browser-compat-data">We&apos;re converting our compatibility data into a machine-readable JSON format</a></strong>.
            This compatibility table still uses the old format,
            because we haven&apos;t yet converted the data it contains.
            <strong><a href="/zh-CN/docs/MDN/Contribute/Structures/Compatibility_tables">Find out how you can help!</a></strong></div>

<div class="htab">
    <a id="AutoCompatibilityTable" name="AutoCompatibilityTable"></a>
    <ul>
        <li class="selected"><a>Desktop</a></li>
        <li><a>Mobile</a></li>
    </ul>
</div></div>

<div id="compat-desktop">
<table class="compat-table">
 <tbody>
  <tr>
   <th>Feature</th>
   <th>Chrome</th>
   <th>Firefox (Gecko)</th>
   <th>Internet Explorer</th>
   <th>Opera</th>
   <th>Safari (WebKit)</th>
  </tr>
  <tr>
   <td>Basic support</td>
   <td>40.0</td>
   <td><a href="/en-US/Firefox/Releases/44">44.0</a> (44.0)<sup>[1]</sup></td>
   <td><span style="color: #f00;">未实现</span></td>
   <td>24</td>
   <td><span style="color: #f00;">未实现</span></td>
  </tr>
  <tr>
   <td>async <code>waitUntil()</code></td>
   <td><span style="color: rgb(255, 153, 0);" title="Compatibility unknown; please update this.">?</span></td>
   <td><a href="/en-US/Firefox/Releases/53">53.0</a> (53.0)<sup>[2]</sup></td>
   <td><span style="color: #f00;">未实现</span></td>
   <td><span style="color: rgb(255, 153, 0);" title="Compatibility unknown; please update this.">?</span></td>
   <td><span style="color: #f00;">未实现</span></td>
  </tr>
 </tbody>
</table>
</div>

<div id="compat-mobile">
<table class="compat-table">
 <tbody>
  <tr>
   <th>Feature</th>
   <th>Android</th>
   <th>Firefox Mobile (Gecko)</th>
   <th>IE Mobile</th>
   <th>Opera Mobile</th>
   <th>Safari Mobile</th>
   <th>Chrome for Android</th>
  </tr>
  <tr>
   <td>Basic support</td>
   <td><span style="color: #f00;">未实现</span></td>
   <td>44.0 (44.0)</td>
   <td><span style="color: #f00;">未实现</span></td>
   <td><span style="color: rgb(255, 153, 0);" title="Compatibility unknown; please update this.">?</span></td>
   <td><span style="color: #f00;">未实现</span></td>
   <td>40.0</td>
  </tr>
  <tr>
   <td>async <code>waitUntil()</code></td>
   <td><span style="color: #f00;">未实现</span></td>
   <td>53.0 (53.0)<sup>[2]</sup></td>
   <td><span style="color: #f00;">未实现</span></td>
   <td><span style="color: rgb(255, 153, 0);" title="Compatibility unknown; please update this.">?</span></td>
   <td><span style="color: #f00;">未实现</span></td>
   <td><span style="color: rgb(255, 153, 0);" title="Compatibility unknown; please update this.">?</span></td>
  </tr>
 </tbody>
</table>
</div>

<p>[1] Service workers (and <a href="/en-US/docs/Web/API/Push_API">Push</a>) have been disabled in the <a href="https://www.mozilla.org/en-US/firefox/organizations/">Firefox 45 &amp; 52 Extended Support Releases</a> (ESR.)</p>

<p>[2] <a href="/zh-CN/docs/Web/API/ExtendableEvent/waitUntil" title="ExtendableEvent.waitUntil() 方法扩展了事件的生命周期。在服务工作线程中，延长事件的寿命从而阻止浏览器在事件中的异步操作完成之前终止服务工作线程。"><code>ExtendableEvent.waitUntil()</code></a> can now be called asynchronously (see <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1263304" title="FIXED: allow event.waitUntil() to be called asynchronously">bug 1263304</a>).</p>

<h2 id="See_also">See also</h2>

<ul>
 <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API/Using_Service_Workers">Using Service Workers</a></li>
 <li><a class="external external-icon" href="https://github.com/mdn/sw-test">Service workers basic code example</a></li>
 <li><a class="external external-icon" href="https://jakearchibald.github.io/isserviceworkerready/">Is ServiceWorker ready?</a></li>
 <li><a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a></li>
 <li><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Performance/Using_web_workers">Using web workers</a></li>
</ul>
