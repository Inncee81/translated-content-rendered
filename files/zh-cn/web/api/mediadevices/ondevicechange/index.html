---
title: MediaDevices.ondevicechange
slug: Web/API/MediaDevices/ondevicechange
translation_of: Web/API/MediaDevices/ondevicechange
---
<p></p><section class="Quick_links" id="Quick_Links"><ol><li><strong><a href="/zh-CN/docs/Web/API/Media_Streams_API">Media Streams API</a></strong></li><li><strong><a href="/zh-CN/docs/Web/API/MediaDevices"><code>MediaDevices</code></a></strong></li><li class="toggle"><details open><summary>属性</summary><ol><li><em><code>ondevicechange</code></em></li></ol></details></li><li class="toggle"><details open><summary>方法</summary><ol><li><a href="/zh-CN/docs/Web/API/MediaDevices/enumerateDevices"><code>enumerateDevices()</code></a></li><li><a href="/zh-CN/docs/Web/API/MediaDevices/getDisplayMedia"><code>getDisplayMedia()</code></a> <a style="opacity: 0.5;" href="/zh-CN/docs/Web/API/MediaDevices/getDisplayMedia$translate">[我来译!]</a></li><li><a href="/zh-CN/docs/Web/API/MediaDevices/getSupportedConstraints"><code>getSupportedConstraints()</code></a></li><li><a href="/zh-CN/docs/Web/API/MediaDevices/getUserMedia"><code>getUserMedia()</code></a></li></ol></details></li><li class="toggle"><details open><summary>继承</summary><ol><li><a href="/zh-CN/docs/Web/API/EventTarget"><code>EventTarget</code></a></li></ol></details></li><li class="toggle"><details open><summary>Events</summary><ol><li><a href="/zh-CN/docs/Web/Events/inactive"><code>inactive</code></a></li><li><a href="/zh-CN/docs/Web/Events/active"><code>active</code></a></li><li><a href="/zh-CN/docs/Web/Events/ended"><code>ended</code></a></li><li><a href="/zh-CN/docs/Web/Events/mute"><code>mute</code></a></li><li><a href="/zh-CN/docs/Web/Events/unmute"><code>unmute</code></a></li><li><a href="/zh-CN/docs/Web/Events/overconstrained"><code>overconstrained</code></a></li><li><a href="/zh-CN/docs/Web/Events/ratechange"><code>ratechange</code></a></li><li><a href="/zh-CN/docs/Web/Events/removetrack"><code>removetrack</code></a></li><li><a href="/zh-CN/docs/Web/Events/addtrack"><code>addtrack</code></a></li><li><a href="/zh-CN/docs/Web/Events/started"><code>started</code></a></li><li><a href="/zh-CN/docs/Web/Events/devicechange"><code>devicechange</code></a></li></ol></details></li><li class="toggle"><details open><summary>Related pages for Media Capture and Streams</summary><ol><li><a href="/zh-CN/docs/Web/API/AudioStreamTrack"><code>AudioStreamTrack</code></a></li><li><a href="/zh-CN/docs/Web/API/BlobEvent"><code>BlobEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/CanvasCaptureMediaStream"><code>CanvasCaptureMediaStream</code></a></li><li><a href="/zh-CN/docs/Web/API/ConstrainBoolean"><code>ConstrainBoolean</code></a></li><li><a href="/zh-CN/docs/Web/API/ConstrainDOMString"><code>ConstrainDOMString</code></a></li><li><a href="/zh-CN/docs/Web/API/ConstrainDouble"><code>ConstrainDouble</code></a></li><li><a href="/zh-CN/docs/Web/API/ConstrainLong"><code>ConstrainLong</code></a></li><li><a href="/zh-CN/docs/Web/API/DoubleRange"><code>DoubleRange</code></a></li><li><a href="/zh-CN/docs/Web/API/HTMLCanvasElement/captureStream"><code>HTMLCanvasElement.captureStream()</code></a></li><li><a href="/zh-CN/docs/Web/API/LongRange"><code>LongRange</code></a></li><li><a href="/zh-CN/docs/Web/API/MediaStream"><code>MediaStream</code></a></li><li><a href="/zh-CN/docs/Web/API/MediaStreamTrack"><code>MediaStreamTrack</code></a></li><li><a href="/zh-CN/docs/Web/API/MediaStreamTrackEvent"><code>MediaStreamTrackEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/MediaTrackCapabilities"><code>MediaTrackCapabilities</code></a></li><li><a href="/zh-CN/docs/Web/API/MediaTrackConstraints"><code>MediaTrackConstraints</code></a></li><li><a href="/zh-CN/docs/Web/API/MediaTrackSettings"><code>MediaTrackSettings</code></a></li><li><a href="/zh-CN/docs/Web/API/MediaTrackSupportedConstraints"><code>MediaTrackSupportedConstraints</code></a></li><li><a href="/zh-CN/docs/Web/API/Navigator/mediaDevices"><code>Navigator.mediaDevices</code></a></li><li><a href="/zh-CN/docs/Web/API/NavigatorUserMedia"><code>NavigatorUserMedia</code></a></li><li><a href="/zh-CN/docs/Web/API/NavigatorUserMediaError"><code>NavigatorUserMediaError</code></a></li><li><a href="/zh-CN/docs/Web/API/VideoStreamTrack"><code>VideoStreamTrack</code></a></li><li><a href="/zh-CN/docs/Web/API/navigator/mediaDevices.getUserMedia"><code>navigator.mediaDevices.getUserMedia()</code></a></li></ol></details></li></ol></section><p></p>

<p><span class="seoSummary"> <strong><code>MediaDevices.ondevicechange</code></strong> 属性是一种<a href="/zh-CN/docs/Web/API/EventHandler" title="此页面仍未被本地化, 期待您的翻译!"><code>EventHandler</code></a>，当<a href="/zh-CN/docs/Web/API/MediaDevices" title="MediaDevices 接口提供访问连接媒体输入的设备，如照相机和麦克风，以及屏幕共享等。"><code>MediaDevices</code></a> 接口的<code><a href="/zh-CN/docs/Web/Reference/Events/devicechange" title="/zh-CN/docs/Web/Reference/Events/devicechange">devicechange</a></code>事件被触发时会被调用. 不论<a href="/en-US/docs/Glossary/user_agent" class="glossaryLink" title="user agent: A user agent is a computer program representing a person, for example, a browser in a Web context.">user agent</a>媒体设备的设置是否可用, 或者网站或者应用发生变了都会触发。无论何时你都可以使用 <a href="/zh-CN/docs/Web/API/MediaDevices/enumerateDevices" title="方法MediaDevices.enumerateDevices() 用于收集系统上可用的多媒体输入和输出设备的信息。"><code>enumerateDevices()</code></a>  去更新可用设备列表.</span></p>

<h2 id="Syntax">Syntax</h2>

<pre class="syntaxbox"><em>MediaDevices</em>.ondevicechange = <em>eventHandler</em>;
</pre>

<h3 id="Value">Value</h3>

<p>A function you provide which accepts as input a <a href="/zh-CN/docs/Web/API/Event" title="此页面仍未被本地化, 期待您的翻译!"><code>Event</code></a> object describing the <a href="/zh-CN/docs/Web/API/Devicehange" title="此页面仍未被本地化, 期待您的翻译!"><code>devicehange</code></a> event that occurred. There is no information about the change included in the event object; to get the updated list of devices, you&apos;ll have to use <a href="/zh-CN/docs/Web/API/MediaDevices/enumerateDevices" title="方法MediaDevices.enumerateDevices() 用于收集系统上可用的多媒体输入和输出设备的信息。"><code>enumerateDevices()</code></a>.</p>

<h2 id="Example" name="Example">Example</h2>

<p>In this example, we create a function called <code>updateDeviceList()</code>, which is called once when <a href="/zh-CN/docs/Web/API/MediaDevices/getUserMedia" title="通常你可以使用 navigator.mediaDevices 来获取 MediaDevices ，例如："><code>MediaDevices.getUserMedia()</code></a> successfully obtains a stream, and then is called any time the device list changes. It displays in the browser window two lists: one of audio devices and one of video devices, with both the device&apos;s label (name) and whether it&apos;s an input or an output device. Because the example provides a handler for the <code><a href="/zh-CN/docs/Web/Reference/Events/devicechange" title="/zh-CN/docs/Web/Reference/Events/devicechange">devicechange</a></code> event, the list is refreshed any time a media device is attached to or removed from the device running the sample.</p>

<div class="hidden">
<h3 id="HTML_content">HTML content</h3>

<pre class="brush: html">&lt;p&gt;Click the start button below to begin the demonstration.&lt;/p&gt;
&lt;div id=&quot;startButton&quot; class=&quot;button&quot;&gt;
  Start
&lt;/div&gt;
&lt;video id=&quot;video&quot; width=&quot;160&quot; height=&quot;120&quot; autoplay&gt;&lt;/video&gt;&lt;br&gt;

&lt;div class=&quot;left&quot;&gt;
  &lt;h2&gt;Audio devices:&lt;/h2&gt;
  &lt;ul class=&quot;deviceList&quot; id=&quot;audioList&quot;&gt;&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&quot;right&quot;&gt;
  &lt;h2&gt;Video devices:&lt;/h2&gt;
  &lt;ul class=&quot;deviceList&quot; id=&quot;videoList&quot;&gt;&lt;/ul&gt;
&lt;/div&gt;

&lt;div id=&quot;log&quot;&gt;&lt;/div&gt;</pre>

<h3 id="CSS_content">CSS content</h3>

<pre class="brush: css">body {
  font: 14px &quot;Open Sans&quot;, &quot;Arial&quot;, sans-serif;
}

video {
  margin-top: 20px;
  border: 1px solid black;
}

.button {
  cursor: pointer;
  width: 160px;
  border: 1px solid black;
  font-size: 16px;
  text-align: center;
  padding-top: 2px;
  padding-bottom: 4px;
  color: white;
  background-color: darkgreen;
}

h2 {
  margin-bottom: 4px;
}

.left {
  float:left;
  width: 48%;
  margin-right: 2%
}

.right {
  float:right;
  width: 48%;
  margin-left: 2%
}

.deviceList {
  border: 1px solid black;
  list-style-type: none;
  margin-top: 2px;
  padding: 6px;
}</pre>

<h3 id="JavaScript_content">JavaScript content</h3>

<h4 id="Other_code">Other code</h4>

<p>Below is other code which, while needed to make this example work, isn&apos;tt related directly to <code>ondevicechange</code>, so we won&apos;t go into any detail.</p>

<pre class="brush: js">let videoElement = document.getElementById(&quot;video&quot;);
let logElement = document.getElementById(&quot;log&quot;);

function log(msg) {
  logElement.innerHTML += msg + &quot;&lt;br&gt;&quot;;
}

document.getElementById(&quot;startButton&quot;).addEventListener(&quot;click&quot;, function() {
  navigator.mediaDevices.getUserMedia({
    video: {
      width: 160,
      height: 120,
      frameRate: 30
    },
    audio: {
      sampleRate: 44100,
      sampleSize: 16,
      volume: 0.25
    }
  }).then(stream =&gt; {
      videoElement.srcObject = stream;
      updateDeviceList();
    })
    .catch(err =&gt; log(err.name + &quot;: &quot; + err.message));
}, false);</pre>
</div>

<p>We set up global variables that contain references to the <a href="/zh-CN/docs/Web/HTML/Element/ul" title="The HTML &lt;ul&gt; 元素 ( 或 HTML 无序列表元素） 代表多项的无序列表，即无数值排序项的集合，且它们在列表中的顺序是没有意义的。通常情况下，无序列表项的头部可以是几种形式，如一个点，一个圆形或方形。头部的风格并不是在页面的HTML描述定义, 但在其相关的CSS 可以用 list-style-type 属性。"><code>&lt;ul&gt;</code></a> elements that are used to list the audio and video devices:</p>

<pre class="brush: js">let audioList = document.getElementById(&quot;audioList&quot;);
let videoList = document.getElementById(&quot;videoList&quot;);</pre>

<h4 id="Getting_and_drawing_the_device_list">Getting and drawing the device list</h4>

<p>Now let&apos;s take a look at <code>updateDeviceList()</code> itself. This method is called any time we want to fetch the current list of media devices and then update the displayed lists of audo and video devices using that information.</p>

<pre class="brush: js">function updateDeviceList() {
  navigator.mediaDevices.enumerateDevices()
  .then(function(devices) {
    audioList.innerHTML = &quot;&quot;;
    videoList.innerHTML = &quot;&quot;;

    devices.forEach(function(device) {
      let elem = document.createElement(&quot;li&quot;);
      let [kind, type, direction] = device.kind.match(/(\w+)(input|output)/i);

      elem.innerHTML = &quot;&lt;strong&gt;&quot; + device.label + &quot;&lt;/strong&gt; (&quot; + direction + &quot;)&quot;;
      if (type === &quot;audio&quot;) {
        audioList.appendChild(elem);
      } else if (type === &quot;video&quot;) {
        videoList.appendChild(elem);
      }
    });
  });
}</pre>

<p><code>updateDeviceList()</code> consists entirely of a call to the function <a href="/zh-CN/docs/Web/API/MediaDevices/enumerateDevices" title="方法MediaDevices.enumerateDevices() 用于收集系统上可用的多媒体输入和输出设备的信息。"><code>enumerateDevices()</code></a> on the <a href="/zh-CN/docs/Web/API/MediaDevices" title="MediaDevices 接口提供访问连接媒体输入的设备，如照相机和麦克风，以及屏幕共享等。"><code>MediaDevices</code></a> object referenced in the <a href="/zh-CN/docs/Web/API/Navigator/mediaDevices" title="MediaDevices 是一个单例对象。通常，您只需直接使用此对象的成员，例如通过调用navigator.mediaDevices.getUserMedia()。"><code>navigator.mediaDevices</code></a> property, as well as the code that&apos;s run when the <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/promise" title="Promise 对象用于表示一个异步操作的最终状态（完成或失败），以及其返回的值。"><code>promise</code></a> returned by <code>enumerateDevices()</code> is fulfilled. The fulfillment handler is called when the device list is ready. The list is passed into the fulfillment handler as an array of <a href="/zh-CN/docs/Web/API/MediaDeviceInfo" title="此页面仍未被本地化, 期待您的翻译!"><code>MediaDeviceInfo</code></a> objects, each describing one media input or output device.</p>

<p>A <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach" title="forEach() 方法对数组的每个元素执行一次提供的函数。"><code>forEach()</code></a> loop is used to scan through all the devices. For each device, we create a new <a href="/zh-CN/docs/Web/HTML/Element/li" title="HTML &lt;li&gt; 元素 (或者 HTML 列表条目元素) 用于表示列表里的条目。它必须被包含在一个父元素里：一个有顺序的列表(&lt;ol&gt;)，一个无顺序的列表(&lt;ul&gt;)，或者一个菜单 (&lt;menu&gt;)。在菜单或者无顺序的列表里，列表条目通常用点排列显示。在有顺序的列表里，列表条目通常是在左边有按升序排列计数的显示，例如数字或者字母。"><code>&lt;li&gt;</code></a> object to be used to display it to the user.</p>

<p>The line <code>let [kind, type, direction] = device.kind.match(/(\w+)(input|output)/i);</code> deserves special notice. This uses <a href="/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destructuring assignment</a> (a new feature of <a href="/en-US/docs/Web/JavaScript/New_in_JavaScript/ECMAScript_6_support_in_Mozilla">ECMAScript 6</a>) to assign the values of the first three items in the array returned by <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/match" title="当一个字符串与一个正则表达式匹配时， match()方法检索匹配项。"><code>String.match()</code></a> to the variables <code>kind</code>, <code>type</code>, and <code>direction</code>. We do this because the value of <a href="/zh-CN/docs/Web/API/MediaDeviceInfo/kind" title="此页面仍未被本地化, 期待您的翻译!"><code>MediaDeviceInfo.kind</code></a> is a single string that includes both the media type and the direction the media flows, such as &quot;audioinput&quot; or &quot;videooutput&quot;. This line, then, pulls out the type (&quot;audio&quot; or &quot;video&quot;) and direction (&quot;input&quot; or &quot;output&quot;) so they can be used to construct the string displayed in the list.</p>

<p>Once the string is assembled, containing the device&apos;s name in bold and the direction in parentheses, it&apos;s appended to the appropriate list by calling <a href="/zh-CN/docs/Web/API/Node/appendChild" title="Node.appendChild() 方法将一个节点添加到指定父节点的子节点列表末尾。"><code>appendChild()</code></a> on either <code>audioList</code> or <code>videoList</code>, as appropriate based on the device type.</p>

<h4 id="Handling_device_list_changes">Handling device list changes</h4>

<p>We call <code>updateDeviceList()</code> in two places. The first is in the <a href="/zh-CN/docs/Web/API/MediaDevices/getUserMedia" title="通常你可以使用 navigator.mediaDevices 来获取 MediaDevices ，例如："><code>getUserMedia()</code></a> promise&apos;s fulfillment handler, to initially fill out the list when the stream is opened. The second is in the event handler for <code><a href="/zh-CN/docs/Web/Reference/Events/devicechange" title="/zh-CN/docs/Web/Reference/Events/devicechange">devicechange</a></code>:</p>

<pre class="brush: js">navigator.mediaDevices.ondevicechange = function(event) {
  updateDeviceList();
}</pre>

<p>With this code in place, each time the user plugs in a camera, microphone, or other media device, or turns one on or off, we call <code>updateDeviceList()</code> to redraw the list of connected devices.</p>

<h3 id="Result">Result</h3>

<p><iframe src="https://mdn.mozillademos.org/zh-CN/docs/Web/API/MediaDevices/ondevicechange$samples/Example?revision=1287813" width="600" class="live-sample-frame sample-code-frame" height="460" frameborder="0" id="frame_Example"></iframe></p>

<h2 id="Specifications">Specifications</h2>

<table class="standard-table">
 <thead>
  <tr>
   <th scope="col">Specification</th>
   <th scope="col">Status</th>
   <th scope="col">Comment</th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td><a lang="en" href="https://w3c.github.io/mediacapture-main/#dom-mediadevices-ondevicechange" class="external" hreflang="en">Media Capture and Streams<br><small lang="zh-CN">ondevicechange</small></a></td>
   <td><span class="spec-CR">Candidate Recommendation</span></td>
   <td>Initial specification.</td>
  </tr>
 </tbody>
</table>

<h2 id="Browser_compatibility">Browser compatibility</h2>

<div><div class="warning notecard"><strong><a href="https://github.com/mdn/browser-compat-data">We&apos;re converting our compatibility data into a machine-readable JSON format</a></strong>.
            This compatibility table still uses the old format,
            because we haven&apos;t yet converted the data it contains.
            <strong><a href="/zh-CN/docs/MDN/Contribute/Structures/Compatibility_tables">Find out how you can help!</a></strong></div>

<div class="htab">
    <a id="AutoCompatibilityTable" name="AutoCompatibilityTable"></a>
    <ul>
        <li class="selected"><a>Desktop</a></li>
        <li><a>Mobile</a></li>
    </ul>
</div></div>

<div id="compat-desktop">
<table class="compat-table">
 <tbody>
  <tr>
   <th>Feature</th>
   <th>Chrome</th>
   <th>Firefox (Gecko)</th>
   <th>Internet Explorer</th>
   <th>Opera</th>
   <th>Safari (WebKit)</th>
  </tr>
  <tr>
   <td>Basic support</td>
   <td>57</td>
   <td><a href="/en-US/Firefox/Releases/51" title="Released on 2017-01-24.">51</a> (51)</td>
   <td><span style="color: rgb(255, 153, 0);" title="Compatibility unknown; please update this.">?</span></td>
   <td>34</td>
   <td><span style="color: rgb(255, 153, 0);" title="Compatibility unknown; please update this.">?</span></td>
  </tr>
 </tbody>
</table>
</div>

<div id="compat-mobile">
<table class="compat-table">
 <tbody>
  <tr>
   <th>Feature</th>
   <th>Android Webview</th>
   <th>Chrome for Android</th>
   <th>Firefox Mobile (Gecko)</th>
   <th>IE Phone</th>
   <th>Opera Mobile</th>
   <th>Safari Mobile</th>
  </tr>
  <tr>
   <td>Basic support</td>
   <td><span style="color: #f00;">未实现</span></td>
   <td><span style="color: #f00;">未实现</span></td>
   <td><span style="color: rgb(255, 153, 0);" title="Compatibility unknown; please update this.">?</span></td>
   <td><span style="color: #f00;">未实现</span></td>
   <td>34</td>
   <td><span style="color: rgb(255, 153, 0);" title="Compatibility unknown; please update this.">?</span></td>
  </tr>
 </tbody>
</table>
</div>

<p>[1] Support for the <code>devicechange</code> event and for <a href="/zh-CN/docs/Web/API/MediaDevices/ondevicechange" title=" MediaDevices.ondevicechange 属性是一种EventHandler，当MediaDevices 接口的devicechange事件被触发时会被调用. 不论user agent媒体设备的设置是否可用, 或者网站或者应用发生变了都会触发。无论何时你都可以使用 enumerateDevices()  去更新可用设备列表."><code>MediaDevices.ondevicechange</code></a> landed in Firefox 51, but <em>only for Mac</em>, and disabled by default. It can be enabled by setting the preference <code>media.ondevicechange.enabled</code> to <code>true</code>. Support for this event was added for Linux and Windows—and it was enabled by default—starting in Firefox 52.</p>

<h2 id="See_also">See also</h2>

<ul>
 <li>The <code><a href="/zh-CN/docs/Web/Reference/Events/devicechange">devicechange</a></code> event and its type, <a href="/zh-CN/docs/Web/API/Event"><code>Event</code></a>.</li>
 <li><a href="/zh-CN/docs/Web/API/MediaDevices/enumerateDevices"><code>MediaDevices.enumerateDevices()</code></a></li>
 <li><a href="/zh-CN/docs/Web/API/MediaDeviceInfo"><code>MediaDeviceInfo</code></a></li>
</ul>
