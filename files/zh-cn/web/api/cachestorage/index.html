---
title: CacheStorage
slug: Web/API/CacheStorage
tags:
  - API
  - CacheStorage
  - ServiceWorker
translation_of: Web/API/CacheStorage
---
<section class="Quick_links" id="Quick_Links"><ol><li><strong><a href="/zh-CN/docs/Web/API/Service_Worker_API">Service Worker API</a></strong></li><li><strong><a href="/zh-CN/docs/Web/API/CacheStorage"><code>CacheStorage</code></a></strong></li><li class="toggle"><details open><summary>方法</summary><ol><li><span class="sidebar-icon"><span class="icon-only-inline" title="这是一个实验性的 API，请尽量不要在生产环境中使用它。"><i class="icon-beaker"> </i></span></span><a href="/zh-CN/docs/Web/API/CacheStorage/delete"><code>delete()</code></a></li><li><span class="sidebar-icon"><span class="icon-only-inline" title="这是一个实验性的 API，请尽量不要在生产环境中使用它。"><i class="icon-beaker"> </i></span></span><a href="/zh-CN/docs/Web/API/CacheStorage/has"><code>has()</code></a></li><li><span class="sidebar-icon"><span class="icon-only-inline" title="这是一个实验性的 API，请尽量不要在生产环境中使用它。"><i class="icon-beaker"> </i></span></span><a href="/zh-CN/docs/Web/API/CacheStorage/keys"><code>keys()</code></a></li><li><span class="sidebar-icon"><span class="icon-only-inline" title="这是一个实验性的 API，请尽量不要在生产环境中使用它。"><i class="icon-beaker"> </i></span></span><a href="/zh-CN/docs/Web/API/CacheStorage/match"><code>match()</code></a></li><li><span class="sidebar-icon"><span class="icon-only-inline" title="这是一个实验性的 API，请尽量不要在生产环境中使用它。"><i class="icon-beaker"> </i></span></span><a href="/zh-CN/docs/Web/API/CacheStorage/open"><code>open()</code></a></li></ol></details></li><li class="toggle"><details open><summary>Related pages for Service Workers API</summary><ol><li><a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a></li><li><a href="/zh-CN/docs/Web/API/Client"><code>Client</code></a></li><li><a href="/zh-CN/docs/Web/API/Clients"><code>Clients</code></a></li><li><a href="/zh-CN/docs/Web/API/ExtendableEvent"><code>ExtendableEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/FetchEvent"><code>FetchEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/InstallEvent"><code>InstallEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/Navigator/serviceWorker"><code>Navigator.serviceWorker</code></a></li><li><a href="/zh-CN/docs/Web/API/NotificationEvent"><code>NotificationEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/PeriodicSyncEvent"><code>PeriodicSyncEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/PeriodicSyncManager"><code>PeriodicSyncManager</code></a></li><li><a href="/zh-CN/docs/Web/API/PeriodicSyncRegistration"><code>PeriodicSyncRegistration</code></a></li><li><a href="/zh-CN/docs/Web/API/ServiceWorker"><code>ServiceWorker</code></a></li><li><a href="/zh-CN/docs/Web/API/ServiceWorkerContainer"><code>ServiceWorkerContainer</code></a></li><li><a href="/zh-CN/docs/Web/API/ServiceWorkerGlobalScope"><code>ServiceWorkerGlobalScope</code></a></li><li><a href="/zh-CN/docs/Web/API/ServiceWorkerRegistration"><code>ServiceWorkerRegistration</code></a></li><li><a href="/zh-CN/docs/Web/API/SyncEvent"><code>SyncEvent</code></a></li><li><a href="/zh-CN/docs/Web/API/SyncManager"><code>SyncManager</code></a></li><li><a href="/zh-CN/docs/Web/API/SyncRegistration"><code>SyncRegistration</code></a></li><li><a href="/zh-CN/docs/Web/API/WindowClient"><code>WindowClient</code></a></li></ol></details></li></ol></section><div class="experimental indicator-warning notecard">
    <p><strong>这是一个实验中的功能</strong><br>此功能某些浏览器尚在开发中，请参考<a href="#Browser_compatibility">浏览器兼容性表格</a>以得到在不同浏览器中适合使用的前缀。由于该功能对应的标准文档可能被重新修订，所以在未来版本的浏览器中该功能的语法和行为可能随之改变。</p>
</div>

<p><strong><code>CacheStorage</code></strong> 接口表示 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象的存储。它提供了一个 <a href="/zh-CN/docs/Web/API/ServiceWorker"><code>ServiceWorker</code></a> 、其它类型worker或者 <a href="/zh-CN/docs/Web/API/Window"><code>window</code></a> 范围内可以访问到的所有命名cache的主目录（它并不是一定要和service workers一起使用，即使它是在service workers规范中定义的），并维护一份字符串名称到相应 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象的映射。</p>

<p><code>CacheStorage</code>  同样暴露了 <a href="/zh-CN/docs/Web/API/CacheStorage/open"><code>CacheStorage.open()</code></a> 和 <a href="/zh-CN/docs/Web/API/CacheStorage/match"><code>CacheStorage.match()</code></a>方法。使用 <a href="/zh-CN/docs/Web/API/CacheStorage/open"><code>CacheStorage.open()</code></a> 获取 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 实例。使用 <a href="/zh-CN/docs/Web/API/CacheStorage/match"><code>CacheStorage.match()</code></a> 检查给定的 <a href="/zh-CN/docs/Web/API/Request"><code>Request</code></a> 是否是 <code>CacheStorage</code> 对象跟踪的任何 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象中的键。</p>

<p>你可以通过 <a href="/zh-CN/docs/Web/API/WorkerGlobalScope/caches"><code>caches</code></a> 属性访问 <code>CacheStorage</code> .</p>

<div class="note"><strong>注意</strong>: CacheStorage 总是对不受信任的源（即那些不使用HTTPS，尽管此定义将来很可能变得更加复杂。）使用 <code>SecurityError</code> reject. 测试时，你可以在Firefox Devtools选项/齿轮菜单中通过选中&quot;通过HTTP启用 Service Workers (当工具箱打开时)&quot; 选项来绕开这个限制。</div>

<div class="note"><strong>注意</strong>: <a href="/zh-CN/docs/Web/API/CacheStorage/match"><code>CacheStorage.match()</code></a> 是一个便捷方法。匹配cache条目的同等功能可以通过执行 <a href="/zh-CN/docs/Web/API/CacheStorage/open"><code>CacheStorage.open()</code></a> 打开cache，使用 <a href="/zh-CN/docs/Web/API/CacheStorage/keys"><code>CacheStorage.keys()</code></a> 返回它包含的条目，并将你所需的条目与 <a href="/zh-CN/docs/Web/API/CacheStorage/match"><code>CacheStorage.match()</code></a> 匹配。</div>

<h2 id="方法">方法</h2>

<dl>
 <dt><a href="/zh-CN/docs/Web/API/CacheStorage/match"><code>CacheStorage.match()</code></a></dt>
 <dd>检查给定的 <a href="/zh-CN/docs/Web/API/Request"><code>Request</code></a> 是否是 <a href="/zh-CN/docs/Web/API/CacheStorage"><code>CacheStorage</code></a> 对象跟踪的任何 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象的键，并返回一个resolve为该匹配的 <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> .</dd>
 <dt><a href="/zh-CN/docs/Web/API/CacheStorage/has"><code>CacheStorage.has()</code></a></dt>
 <dd>如果存在与 <code>cacheName</code> 匹配的 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象，则返回一个resolve为true的 <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> .</dd>
 <dt><a href="/zh-CN/docs/Web/API/CacheStorage/open"><code>CacheStorage.open()</code></a></dt>
 <dd>返回一个 <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> ，resolve为匹配  <code>cacheName</code> （如果不存在则创建一个新的cache）的 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象</dd>
 <dt><a href="/zh-CN/docs/Web/API/CacheStorage/delete"><code>CacheStorage.delete()</code></a></dt>
 <dd>查找匹配 <code>cacheName</code> 的 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象，如果找到，则删除 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象并返回一个resolve为true的 <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> 。如果没有找到 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象，则返回 <code>false</code>.</dd>
 <dt><a href="/zh-CN/docs/Web/API/CacheStorage/keys"><code>CacheStorage.keys()</code></a></dt>
 <dd>返回一个 <a href="/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> ，它将使用一个包含与 <a href="/zh-CN/docs/Web/API/CacheStorage"><code>CacheStorage</code></a> 追踪的所有命名 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象对应字符串的数组来resolve. 使用该方法迭代所有 <a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a> 对象的列表。</dd>
</dl>

<h2 id="示例">示例</h2>

<p>此代码片段来自于MDN <a href="https://github.com/mdn/sw-test/">sw-test example</a> （请参阅<a href="https://mdn.github.io/sw-test/">sw-test running live</a>.）此 service worker 脚本等待 <a href="/zh-CN/docs/Web/API/InstallEvent"><code>InstallEvent</code></a> 触发，然后运行 <a href="/zh-CN/docs/Web/API/ExtendableEvent/waitUntil"><code>waitUntil</code></a> 来处理应用程序的安装过程。这包括调用 <a href="/zh-CN/docs/Web/API/CacheStorage/open"><code>CacheStorage.open</code></a> 创建一个新的cache，然后使用 <a href="/zh-CN/docs/Web/API/Cache/addAll"><code>Cache.addAll</code></a> 向其添加一系列资源。</p>

<p>在第二个代码块，我们等待 <a href="/zh-CN/docs/Web/API/FetchEvent"><code>FetchEvent</code></a> 触发。我们构建自定义相应，像这样：</p>

<ol>
 <li>检查CacheStorage中是否找到了匹配请求的内容。如果是，使用匹配内容。</li>
 <li>如果没有，从网络获取请求，然后同样打开第一个代码块中创建的cache，并使用 <a href="/zh-CN/docs/Web/API/Cache/put"><code>Cache.put</code></a> (<code>cache.put(event.request, response.clone())</code>.) 将请求的clone副本添加到它。</li>
 <li>如果此操作失败（例如，因为网络关闭），返回备用相应。</li>
</ol>

<p>最后，使用 <a href="/zh-CN/docs/Web/API/FetchEvent/respondWith"><code>FetchEvent.respondWith</code></a> 返回自定义响应最终等于的内容。</p>

<pre class="brush: js notranslate">this.addEventListener(&apos;install&apos;, function(event) {
  event.waitUntil(
    caches.open(&apos;v1&apos;).then(function(cache) {
      return cache.addAll([
        &apos;/sw-test/&apos;,
        &apos;/sw-test/index.html&apos;,
        &apos;/sw-test/style.css&apos;,
        &apos;/sw-test/app.js&apos;,
        &apos;/sw-test/image-list.js&apos;,
        &apos;/sw-test/star-wars-logo.jpg&apos;,
        &apos;/sw-test/gallery/bountyHunters.jpg&apos;,
        &apos;/sw-test/gallery/myLittleVader.jpg&apos;,
        &apos;/sw-test/gallery/snowTroopers.jpg&apos;
      ]);
    })
  );
});

this.addEventListener(&apos;fetch&apos;, function(event) {
  var response;
  event.respondWith(caches.match(event.request).catch(function() {
    return fetch(event.request);
  }).then(function(r) {
    response = r;
    caches.open(&apos;v1&apos;).then(function(cache) {
      cache.put(event.request, response);
    });
    return response.clone();
  }).catch(function() {
    return caches.match(&apos;/sw-test/gallery/myLittleVader.jpg&apos;);
  }));
});</pre>

<h2 id="说明">说明</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <th scope="col">Specification</th>
   <th scope="col">Status</th>
   <th scope="col">Comment</th>
  </tr>
  <tr>
   <td><a class="external" href="https://w3c.github.io/ServiceWorker/#cache-storage" hreflang="en" lang="en">Service Workers<br><small lang="zh-CN">CacheStorage</small></a></td>
   <td><span class="spec-WD">Working Draft</span></td>
   <td>Initial definition.</td>
  </tr>
 </tbody>
</table>

<h2 id="浏览器兼容">浏览器兼容</h2>

<div class="hidden">
<p>The compatibility table on this page is generated from structured data. If you&apos;d like to contribute to the data, please check out <a href="https://github.com/mdn/browser-compat-data">https://github.com/mdn/browser-compat-data</a> and send us a pull request.</p>
</div>

<div class="bc-data" id="bcd:api.CacheStorage"></div>

<h2 id="参见">参见</h2>

<ul>
 <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API/Using_Service_Workers">Using Service Workers</a></li>
 <li><a href="/zh-CN/docs/Web/API/Cache"><code>Cache</code></a></li>
 <li><a href="/zh-CN/docs/Web/API/WorkerGlobalScope/caches"><code>WorkerGlobalScope.caches</code></a></li>
</ul>
