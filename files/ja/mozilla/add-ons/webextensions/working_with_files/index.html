---
title: ファイルの操作
slug: Mozilla/Add-ons/WebExtensions/Working_with_files
tags:
  - Guide
  - WebExtensions
translation_of: Mozilla/Add-ons/WebExtensions/Working_with_files
---
<div><section class="Quick_links" id="Quick_Links">
  <ol>
    <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions"><strong>ブラウザー拡張機能</strong></a></li>
    <li class="toggle">
      <details>
        <summary>始めましょう</summary>
        <ol>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions">拡張機能とは何か?</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension">初めての拡張機能</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension">2つめの拡張機能</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension">拡張機能の中身</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Examples">拡張機能の例</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/What_next_">次にどうするのか？</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>概念</summary>
        <ol>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs">JavaScript API 群の利用</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Content_scripts">コンテンツスクリプト</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Match_patterns">マッチパターン</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Working_with_files">ファイルの操作</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Internationalization">多言語対応</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Security_best_practices">セキュリティのベストプラクティス</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy">Content Security Policy</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Native_messaging">Native messaging</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>ユーザーインターフェイス</summary>
        <ol>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface">ユーザーインターフェイス</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Accessibility_guidelines">Accessibility guidelines</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action">ブラウザーツールバーボタン</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions">アドレスバーボタン</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars">サイドバー</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items">コンテキストメニュー項目</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages">オプションページ</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages">ページ拡張</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications">通知</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox">Address bar suggestions</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels">開発ツールパネル</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>逆引きリファレンス</summary>
        <ol>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests">HTTP リクエストへの介入</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page">web ページの変更</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page">外部コンテンツの挿入</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar">ツールバーボタンの追加</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page">設定画面の実装</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API">Tabs API 群の使い方</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API">Bookmark API 群の使い方</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API">Cookie API 群の使い方</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities">contextual identities の使い方</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension">Build a cross-browser extension</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/onboarding_upboarding_offboarding_best_practices">Onboard, upboard, and offboard users</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>移行</summary>
        <ol>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators">Firefox differentiators</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Porting_a_Google_Chrome_extension">Google Chrome extension からの移行</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Porting_a_legacy_Firefox_add-on">古い Firefox アドオンの移行</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Comparison_with_the_Add-on_SDK">Add-on SDK との比較</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Comparison_with_XUL_XPCOM_extensions">XUL/XPCOM 拡張との比較</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations">Differences between API implementations</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities">Chrome との非互換性</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Differences_between_desktop_and_Android">デスクトップと Android の差</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Firefox でのワークフロー</summary>
        <ol>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Development_Tools">Developer tools</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Choose_a_Firefox_version_for_web_extension_develop">Choose a Firefox version</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/User_experience_best_practices">ユーザー体験の成功事例</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Prompt_users_for_data_and_privacy_consents">Prompt users for data and privacy consents</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Temporary_Installation_in_Firefox">Firefox への一時的なインストール</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Debugging">デバッグ</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Testing_persistent_and_restart_features">テストの持続と再起動機能</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Test_permission_requests">Test permission requests</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Developing_WebExtensions_for_Firefox_for_Android">Firefox for Android の拡張機能開発</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Getting_started_with_web-ext">web-ext を使って始めよう</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/web-ext_command_reference">web-ext コマンドリファレンス</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/WebExtensions_and_the_Add-on_ID">Extensions と Add-on ID</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Request_the_right_permissions">正しいパーミッションを要求する</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Best_practices_for_updating_your_extension">Best practices for updating your extension</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>JavaScript API 群</summary>
        <ol><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs">Browser support for JavaScript APIs</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/alarms">alarms</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks">bookmarks</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/browserAction">browserAction</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/browserSettings">browserSettings</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/browsingData">browsingData</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/clipboard">clipboard</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/commands">commands</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/contentScripts">contentScripts</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/contextualIdentities">contextualIdentities</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/cookies">cookies</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/devtools.inspectedWindow">devtools.inspectedWindow</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/devtools.network">devtools.network</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/devtools.panels">devtools.panels</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/downloads">downloads</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/events">events</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/extension">extension</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/extensionTypes">extensionTypes</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/find">find</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/history">history</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/i18n">i18n</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/identity">identity</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/idle">idle</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/management">management</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/menus">menus</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/notifications">notifications</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/omnibox">omnibox</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/pageAction">pageAction</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/permissions">permissions</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/pkcs11">pkcs11</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/privacy">privacy</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/proxy">proxy</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/runtime">runtime</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/sessions">sessions</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/sidebarAction">sidebarAction</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/storage">storage</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/tabs">tabs</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/theme">theme</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/topSites">topSites</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/types">types</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation">webNavigation</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/webRequest">webRequest</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/windows">windows</a></li></ol>
      </details>
    </li>

    <li class="toggle">
      <details>
      <summary>Manifest keys</summary>
      <ol><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/author">author</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background">background</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action">browser_action</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_specific_settings">browser_specific_settings</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_settings_overrides">chrome_settings_overrides</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/chrome_url_overrides">chrome_url_overrides</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/commands">commands</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts">content_scripts</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_security_policy">content_security_policy</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/default_locale">default_locale</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description">description</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/developer">developer</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/devtools_page">devtools_page</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url">homepage_url</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons">icons</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/incognito">incognito</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version">manifest_version</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name">name</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/omnibox">omnibox</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/optional_permissions">optional_permissions</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/options_ui">options_ui</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/page_action">page_action</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions">permissions</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/protocol_handlers">protocol_handlers</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/short_name">short_name</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/sidebar_action">sidebar_action</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme">theme</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version">version</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version_name">version_name</a></li><li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources">web_accessible_resources</a></li></ol>
      </details>
    </li>
    <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Distribution_options">Distribution Options</a></li>
    <li><a href="/ja/docs/Mozilla/Add-ons/Themes"><strong>テーマ</strong></a></li>
    <li class="toggle">
      <details>
        <summary>ブラウザのテーマ</summary>
        <ol>
          <li><a href="/ja/docs/Mozilla/Add-ons/Themes/Theme_concepts">ブラウザのテーマのコンセプト</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/Themes/Using_the_AMO_theme_generator">Using the AMO theme generator</a></li>
        </ol>
      </details>
    </li>
    <li><a href="/ja/docs/Mozilla/Add-ons/Distribution"><strong>公開して配布する</strong></a></li>
    <li class="toggle">
      <details>
        <summary>アドオンを公開する</summary>
        <ol>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Developer_accounts">Developer accounts</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/Distribution">署名して配布する</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Package_your_extension_">拡張機能をパッケージ化する</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/Distribution/Submitting_an_add-on">アドオンを投稿する</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/Source_Code_Submission">ソースコードの提出</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/Distribution/Resources_for_publishers">公開した人のためのドキュメント</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/Listing">魅力的に作るためのリスト</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/Distribution/Make_money_from_browser_extensions">Make money from browser extensions</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/Distribution/Promoting_your_extension_or_theme">Promoting your extension or theme</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/AMO/Policy/Reviews">レビューポリシー</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/AMO/Policy/Agreement">開発者同意事項</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/AMO/Policy/Featured">AMO でおすすめされるアドオン</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/Distribution/Retiring_your_extension">拡張機能のクロージング</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>アドオンの配布</summary>
        <ol>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Sideloading_add-ons">サイドローディング</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Add-ons_for_desktop_apps">デスクトップアプリ</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Add-ons_in_the_enterprise">エンタープライズ</a></li>
        </ol>
      </details>
    </li>
    <li><a href="https://discourse.mozilla.org/c/add-ons"><strong>コミュニティとサポート</strong></a></li>
    <li class="toggle">
      <details>
        <summary>チャンネル</summary>
        <ol>
          <li><a href="https://blog.mozilla.org/addons">ブログ</a></li>
          <li><a href="https://discourse.mozilla.org/c/add-ons">フォーラム</a></li>
          <li><a href="https://stackoverflow.com/questions/tagged/firefox-addon">Stack Overflow</a></li>
          <li><a href="/ja/docs/Mozilla/Add-ons/#Contact_us">コンタクト</a></li>
        </ol>
      </details>
    </li>
  </ol>
</section></div>

<p>拡張機能にて完全な機能を提供するのにファイルを操作する必要があるかもしれません。この記事ではファイルを扱うための 5 つのメカニズムを見ていきます:</p>

<ul>
 <li>ユーザーが選択したファイルをダウンロードフォルダーにダウンロードする</li>
 <li>ウェブページのファイルピッカーを使ってファイルを開く</li>
 <li>ウェブページへのドラッグアンドドロップを使ってファイルを開く</li>
 <li>idb-file-storage ライブラリーを使ってファイルや blob を IndexedDB に保管する</li>
 <li>ユーザーのコンピューター上のネイティブアプリケーションにファイルを渡す</li>
</ul>

<p>それぞれのメカニズムに対し、各 API ドキュメンテーションやガイド、対応する API の使用法の例のリファレンスと一緒に、使い方を紹介します。</p>

<h2 id="Download_files_using_the_downloads_API" name="Download_files_using_the_downloads_API">ダウンロード API を使ってファイルをダウンロード</h2>

<p>この仕組みでは、あなたのウェブサイト(や URL で決められたあらゆる場所)からユーザーのコンピューターにファイルを入手できます。主要なメソッドは <a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/downloads/download" title="downloads API の download() 関数ではURLとそのほかのオプションの設定を行うことでファイルのダウンロードをすることができます。"><code>downloads.download()</code></a> で、その簡単なフォームで URL を受け付けて、その URL からユーザーの既定のダウンロードフォルダーにファイルをダウンロードします:</p>

<pre class="brush: js">browser.downloads.download({url: &quot;https://example.org/image.png&quot;})</pre>

<p>ユーザーが <code>saveAs</code> パラメーターで指定した場所にダウンロードさせることもできます。</p>

<div class="note notecard">
<p>Using <a href="https://developer.mozilla.org/ja/docs/Web/API/URL/createObjectURL">URL.createObjectURL()</a> you can also download files and blobs defined in your JavaScript, which can include local content retrieved from IndexedDB.</p>
</div>

<p>ダウンロード API はダウンロードをキャンセル、停止、再開、消去、削除することもできます; ダウンロードマネージャーでダウンロード済みのファイルを探します; コンピューターのファイルマネージャーでダウンロード済みのファイルを表示します; 関連付けられたアプリケーションでそのファイルを開きます。</p>

<p>この API を使うには <a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json">manifest.json</a> ファイルにて &quot;downloads&quot;<a href="/ja/docs/Web/API/Permissions#API_permissions"> API パーミッション</a>が必要です。</p>

<p>例: <a href="https://github.com/mdn/webextensions-examples/tree/master/latest-download">Latest download</a><br>
 API リファレンス: <a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/downloads">downloads API</a></p>

<h2 id="Open_files_in_an_extension_using_a_file_picker" name="Open_files_in_an_extension_using_a_file_picker">ファイルピッカーを使って拡張機能でファイルを開く</h2>

<p>ユーザーのコンピューターからのファイルを扱いたい場合、1 つの選択はコンピューターのファイルブラウザーを使ってユーザーがファイル選択できるようにすることです。新しいページを作るか既存のページにコードを挿入して、ファイルピッカーをユーザーに提供するため HTML <code>input</code> 要素の <code>file</code> タイプを使います。ユーザーがファイルを選ぶと、ページに関連付けられたスクリプトにより、<a href="/ja/docs/Web/API/File">DOM File API</a> を使ってウェブアプリケーションと同様な方法でファイルの中身にページからアクセスできます。</p>

<p>例: <a href="https://github.com/mdn/webextensions-examples/tree/master/imagify">Imagify</a><br>
 ガイド: <a href="/ja/docs/Using_files_from_web_applications">Using files from web applications</a><br>
 API リファレンス: <a href="/ja/docs/Web/HTML/Element/input/file">HTML input element</a> | <a href="/ja/docs/Web/API/File">DOM File API</a></p>

<div class="note notecard">
<p>選択したフォルダーの全ファイルにアクセスや処理したい場合、<code>&lt;input type=&quot;file&quot; </code><code>webkitdirectory=&quot;true&quot;/&gt;</code> を使ってフォルダーを選択して、そこにある全ファイルを返すようにできます。</p>
</div>

<h2 id="Open_files_in_an_extension_using_drag_and_drop" name="Open_files_in_an_extension_using_drag_and_drop">ドラッグアンドドロップを使って拡張機能でファイルを開く</h2>

<p>Web Drag and Drop API では別のファイルピッカーがあります。このメソッドを使うには、UI にフィットする ‘drop zone’ を設置して、<a href="/ja/docs/Web/Events/dragenter">dragenter</a>,<a href="/ja/docs/Web/Events/dragover"> dragover</a>, <a href="/ja/docs/Web/Events/drop">drop</a> イベントのリスナーを要素に追加します。ドロップイベントのハンドラーでは、<a href="/ja/docs/Web/API/DataTransfer/files">DataTransfer.files</a> を使って dataTransfer プロパティから提供されたオブジェクトからユーザーにドロップされたあらゆるファイルに、コードからアクセスできます。すると <a href="/ja/docs/Web/API/File">DOM File API</a> を使ってファイルにアクセス・操作することができます。</p>

<p>例: <a href="https://github.com/mdn/webextensions-examples/tree/master/imagify">Imagify</a><br>
 ガイド: <a href="/ja/docs/Using_files_from_web_applications">Using files from web applications</a> | <a href="/ja/docs/Web/API/HTML_Drag_and_Drop_API/File_drag_and_drop">File drag and drop</a><br>
 API リファレンス: <a href="/ja/docs/Web/API/File">DOM File API</a></p>

<h2 id="Store_files_data_locally_using_the_IndexedDB_file_storage_library" name="Store_files_data_locally_using_the_IndexedDB_file_storage_library"> IndexedDB ファイルストレージライブラリーを使ってローカルにファイル保存する</h2>

<p>拡張機能がローカルにファイル保存する必要がある場合、<a href="https://www.npmjs.com/package/idb-file-storage">idb-file-storage ライブラリー</a>は 完結な Promiseベースの<a href="/ja/docs/Web/API/IndexedDB_API">IndexedDB API</a>ラッパーであり、ストレージやファイルやblobの取得を助けます。</p>

<p>Firefoxでは、このライブラリーは非標準の IDBMutableFile APIのラッパーとしてPromiseベースのAPIも提供します (IDBMutableFile API を使うと、拡張機能はIndexedDB データベースファイルオブジェクトの作成と保存ができて、それによりメモリーにファイルを読み込むことなくファイルの中身を読み書きできるAPIが提供されます)</p>

<p>このライブラリーのキーとなる機能は:</p>

<ul>
 <li>IDBFileStorageインスタンスを返す <a href="https://rpl.github.io/idb-file-storage/function/index.html#static-function-getFileStorage">getFileStorage</a>。名前付きストレージが存在しない場合には作成します。</li>
 <li><a href="https://rpl.github.io/idb-file-storage/class/src/idb-file-storage.js~IDBFileStorage.html">IDBFileStorage</a>。これはファイルを保存したり取得するメソッドを提供します、例えば次のもの:
  <ul>
   <li>データベース内の(フィルターされた)ファイルのlist</li>
   <li>データベースにファイルやblobを追加するput</li>
   <li>データベースからファイルやblobを取得するget</li>
   <li>データベースからファイルやblobを削除するremove</li>
  </ul>
 </li>
</ul>

<p><a href="https://github.com/mdn/webextensions-examples/tree/master/store-collected-images/webextension-plain">Store Collected Images</a> の例ではこの機能の大半の使い方を示します。(IDBMutableFile は含まれていませんが、<a href="https://rpl.github.io/idb-file-storage/examples/">idb-file-storage examples</a> にて、ライブラリーの他の多くの例と一緒に見ることができます)。</p>

<p>Store Collected Images の例では、画像コンテキストメニューを使ってユーザーが画像を追加できます。選択された画像はポップアップメニューに集められて、名前付きコレクションに保存されます。ツールバーボタンの(<a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/browserAction" title="ブラウザーのツールバーにボタンを追加します。"><code>browserAction</code></a>) ナビゲートコレクションのページを開き、そこでユーザーは選択を狭められるフィルターオプションを使って、保存された画像を見たり消去したりできます。<a href="https://youtu.be/t6aVqMMe2Rc">この例を見てください</a>。</p>

<p>/utils/ 内の <a href="https://github.com/mdn/webextensions-examples/blob/master/store-collected-images/webextension-plain/utils/image-store.js">image-store.js</a> を見てライブラリーの動作を理解できます:</p>

<h3 id="Creating_the_store_and_saving_the_images" name="Creating_the_store_and_saving_the_images">store を作成して画像を保存する</h3>

<pre class="brush: js">async function saveCollectedBlobs(collectionName, collectedBlobs) {
 const storedImages = await getFileStorage({name: &quot;stored-images&quot;});

 for (const item of collectedBlobs) {
    await storedImages.put(`${collectionName}/${item.uuid}`, item.blob);
 }
}</pre>

<p><code>saveCollectedBlobs</code> is called when the user clicks save in the popup and has provided a name for the image collection. First, <code>getFileStorage</code> creates, if it does not exist already, or retrieves the IndexedDB database “stored-images” to the object <code>storedImages</code>. <code>storedImages.put</code> then adds each collected image to the database, under the collection name, using the blob’s unique id (the file name). If the image being store has the same name as one already in the database, it is overwritten. If you want to avoid this, query the database first using <code>imagesStore.list()</code> with a filter for the file name, and, if the list returns a file, add a suitable suffix to the name of the new image to store a separate item.</p>

<h3 id="Retrieving_stored_images_for_display" name="Retrieving_stored_images_for_display">保管された画像を表示用に取得する</h3>

<pre class="brush: js">export async function loadStoredImages(filter) {
 const imagesStore = await getFileStorage({name: &quot;stored-images&quot;});
 let listOptions = filter ? {includes: filter} : undefined;
 const imagesList = await imagesStore.list(listOptions);
 let storedImages = [];
 for (const storedName of imagesList) {
    const blob = await imagesStore.get(storedName);
    storedImages.push({storedName, blobUrl: URL.createObjectURL(blob)});
 }
 return storedImages;
}
</pre>

<p><code>loadStoredImages</code> is called when the user clicks view or reload in the navigate collection page. <code>getFileStorage</code> opens the “stored-images” database, then <code>imagesStore.list</code> gets a filtered list of the stored images. This list is then used to retrieve images with <code>imagesStore.get</code> and build a list to return to the UI.</p>

<p>Note the use of <a href="/ja/docs/Web/API/URL/createObjectURL">URL.createObjectURL(blob)</a> to create a URL that references the image blob. This URL is then used in the UI (<a href="https://github.com/mdn/webextensions-examples/blob/master/store-collected-images/webextension-plain/navigate-collection.js">navigate-collection.js</a><a href="https://github.com/mdn/webextensions-examples/blob/master/store-collected-images/webextension-plain/navigate-collection.js">collection.js</a>) to display the image.</p>

<h3 id="Delete_collected_images" name="Delete_collected_images">集まった画像を削除する</h3>

<pre class="brush: js">async function removeStoredImages(storedImages) {
 const imagesStore = await getFileStorage({name: &quot;stored-images&quot;});
 for (const storedImage of storedImages) {
    URL.revokeObjectURL(storedImage.blobUrl);
    await imagesStore.remove(storedImage.storedName);
 }
}
</pre>

<p><code>removeStoredImages</code> is called when the user clicks delete in the navigate collection page. Again, <code>getFileStorage</code> opens the “stored-images” database then <code>imagesStore.remove</code> removes each image from the filtered list of images.</p>

<p>Note the use of <a href="/ja/docs/Web/API/URL/revokeObjectURL">URL.revokeObjectURL()</a> to explicitly revoke the blob URL. This enables the garbage collector to free the memory allocated to the URL. If this is not done, the memory will not get returned until the page on which it was created is closed. If the URL was created in an extension’s background page, this is not unloaded until the extension is disabled, uninstalled, or reloaded, so holding this memory unnecessarily could affect browser performance. If the URL is created in an extension’s page (new tab, popup, or sidebar) the memory is released when the page is closed, but it is still a good practice to revoke the URL when it is no longer needed.</p>

<p>Once the blob URL has been revoked any attempt to load it will result in an error. 例えば、if the blob url was used as the <code>SRC</code> attribute of an <code>IMG</code> tag, the image will not load and will not be visible. It is therefore good practice to remove any revoked blob urls from generated HTML elements when the blob URL is revoked.</p>

<p>Example: <a href="https://github.com/mdn/webextensions-examples/tree/master/store-collected-images/webextension-plain">Store Collected Images</a><br>
 API References:  <a href="https://rpl.github.io/idb-file-storage/">idb-file-storage library</a></p>

<div class="note notecard">
<p>Note: You can also use the full Web <a href="https://developer.mozilla.org/ja/docs/Web/API/IndexedDB_API">IndexedDB API</a> to store data from your extension. This can be useful where you need to store data that isn’t handled well by the simple key/value pairs offered by the DOM <a href="https://developer.mozilla.org/ja/Add-ons/WebExtensions/API/Storage">Storage API</a>.</p>
</div>

<h2 id="Process_files_in_a_local_app" name="Process_files_in_a_local_app">ローカルアプリでファイルを処理する</h2>

<p>Where you have a native app or want to deliver additional native features for file processing, use native messaging to pass a file to a native app for processing.</p>

<p>You have two options:</p>

<ul>
 <li>Connection-based messaging. Here you trigger the process with runtime.connectNative(), which returns a <a href="https://developer.mozilla.org/ja/docs/Mozilla/Add-ons/WebExtensions/API/runtime/Port">runtime.Port</a> object. You can then pass a JSON message to the native application using the postMessage() function of Port. Using the onMessage.addListener() function of Port you can listen for messages from the native application. The native application is opened if it is not running when runtime.connectNative() is called and the application remains running until the extension calls Port.disconnect() or the page that connected to it is closed.</li>
 <li>Connectionless messaging. Here you use runtime.sendNativeMessage() to send a JSON message to a new, temporary instance of the native application. The browser closes the native application after receiving any message back from the native application.</li>
</ul>

<p>To add the file or blob you want the native application to process use <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify">JSON.stringify()</a>.</p>

<p>To use this method the extension must request the &quot;nativeMessaging&quot;<a href="https://developer.mozilla.org/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions"> permission</a> in its manifest.json file. Reciprocally, the native application must grant permission for the extension by including its ID in the &quot;allowed_extensions&quot; field of the app manifest.</p>

<p>Example: <a href="https://github.com/mdn/webextensions-examples/tree/master/native-messaging">Native Messaging</a> (illustrates simple messaging only)<br>
 Guides: <a href="https://developer.mozilla.org/ja/Add-ons/WebExtensions/Native_messaging">Native messaging</a><br>
 API references: <a href="https://developer.mozilla.org/ja/Add-ons/WebExtensions/API/runtime">runtime API</a></p>
