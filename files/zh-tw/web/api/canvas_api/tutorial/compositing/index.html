---
title: 合成效果
slug: Web/API/Canvas_API/Tutorial/Compositing
translation_of: Web/API/Canvas_API/Tutorial/Compositing
---
<div><section id="Quick_Links">
 <ol>
  <li><a href="/zh-TW/docs/Web/API/Canvas_API"><strong>Canvas API</strong></a></li>
  <li class="toggle">
    <details open>
      <summary>Canvas tutorial</summary>
      <ol>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Basic_usage">Basic usage</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes">Drawing shapes</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Applying_styles_and_colors">Applying styles and colors</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Drawing_text">Drawing text</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Using_images">Using images</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Transformations">Transformations</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Compositing">Compositing and clipping</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Basic_animations">Basic animations</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Advanced_animations">Advanced animations</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas">Pixel manipulation</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Hit_regions_and_accessibility">Hit regions and accessibility</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas">Optimizing the canvas</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Finale">Finale</a></li>
        </ol>
    </details>
  </li>
  <li class="toggle">
    <details open>
      <summary>Examples</summary>
      <ol>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/A_basic_ray-caster">A basic raycaster</a></li>
        <li><a href="/zh-TW/Add-ons/Code_snippets/Canvas">Canvas code snippets</a></li>
        <li><a href="/zh-TW/docs/Web/API/Canvas_API/Manipulating_video_using_canvas">Manipulating video using canvas</a></li>
      </ol>
    </details>
  </li>
  <li class="toggle">
    <details open>
      <summary>Interfaces</summary>
      <ol>
        <li><a href="/zh-TW/docs/Web/API/HTMLCanvasElement"><code>HTMLCanvasElement</code></a></li>
        <li><a href="/zh-TW/docs/Web/API/CanvasRenderingContext2D"><code>CanvasRenderingContext2D</code></a></li>
        <li><a href="/zh-TW/docs/Web/API/CanvasGradient"><code>CanvasGradient</code></a></li>
        <li><a href="/zh-TW/docs/Web/API/CanvasPattern"><code>CanvasPattern</code></a></li>
        <li><a href="/zh-TW/docs/Web/API/ImageBitmap"><code>ImageBitmap</code></a></li>
        <li><a href="/zh-TW/docs/Web/API/ImageData"><code>ImageData</code></a></li>
        <li><a href="/zh-TW/docs/Web/API/TextMetrics"><code>TextMetrics</code></a></li>
        <li><span class="sidebar-icon"><span title="This is an experimental API that should not be used in production code."><i class="icon-beaker"> </i></span></span> <a href="/zh-TW/docs/Web/API/Path2D"><code>Path2D</code></a></li>
      </ol>
    </details>
  </li>
  <li><strong><a href="/zh-TW/docs/MDN">Documentation:</a></strong></li>
  <li class="toggle">
    <details>
      <summary>Useful lists</summary>
      <ol>
        <li><a href="/zh-TW/docs/tag/Canvas">Pages tagged &quot;Canvas&quot;</a></li>
      </ol>
    </details>
  </li>
  <li class="toggle">
    <details>
      <summary>Contribute</summary>
      <ol>
        <li><a href="/zh-TW/docs/MDN/Doc_status/API/Canvas">Canvas doc status</a></li>
        <li><a href="/zh-TW/docs/MDN">The MDN project</a></li>
      </ol>
    </details>
  </li>
 </ol>
</section> <div style="text-align: right;" class="prevnext">
    <p><a style="float: left;" href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Transformations" class="button">« 前頁</a><a href="/zh-TW/docs/Web/API/Canvas_API/Tutorial/Basic_animations" class="button">次頁  »</a></p>
</div></div>

<p>在前述的範例中，新繪製的圖形總會覆蓋在之前的圖形上，對大多數情況來說這相當正常，不過它也限制了圖形繪製的順序。其實我們可以透過 globalCompositeOperation 屬性來改變這項預設行為。</p>

<h2 id="globalCompositeOperation" name="globalCompositeOperation"><code>globalCompositeOperation</code></h2>

<p>利用 globalCompositeOperation，我們可以將新圖形繪製在舊圖形之下、遮蓋部分區域、清除畫布部分區域 (不同於 clearRect() 函式只能清除矩形區域)。</p>

<dl>
 <dt><code>globalCompositeOperation = <em>type</em></code></dt>
 <dt>type 字串可指定為以下 12 種合成設定之一，每一種合成設定均將套用到新繪製的圖形上。</dt>
</dl>

<div class="note notecard">
<p><strong>Note:</strong> 下列圖例的藍色矩形是舊圖形，紅色圓形是新圖形。</p>
</div>

<table style="width: 100%;">
 <tbody>
  <tr>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>source-over</strong> 預設值。將新圖形畫在舊圖形之上。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/220/Canvas_composite_srcovr.png" alt="Image:Canvas_composite_srcovr.png" class="internal"></p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>destination-over</strong><br>
     將新圖形畫在舊圖形之下。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/215/Canvas_composite_destovr.png" alt="Image:Canvas_composite_destovr.png" class="internal"></p>
   </td>
  </tr>
  <tr>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>source-in</strong><br>
     只保留新、舊圖形重疊的新圖形區域，其餘皆變為透明。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/218/Canvas_composite_srcin.png" alt="Image:Canvas_composite_srcin.png" class="internal"></p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>destination-in</strong><br>
     只保留新、舊圖形重疊的舊圖形區域，其餘皆變為透明。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/213/Canvas_composite_destin.png" alt="Image:Canvas_composite_destin.png" class="internal"></p>
   </td>
  </tr>
  <tr>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>source-out</strong><br>
     只保留新、舊圖形非重疊的新圖形區域，其餘皆變為透明。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/219/Canvas_composite_srcout.png" alt="Image:Canvas_composite_srcout.png" class="internal"></p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>destination-out</strong><br>
     只保留新、舊圖形非重疊的舊圖形區域，其餘皆變為透明。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/214/Canvas_composite_destout.png" alt="Image:Canvas_composite_destout.png" class="internal"></p>
   </td>
  </tr>
  <tr>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>source-atop</strong><br>
     新圖形只繪製在新、舊圖形重疊的新圖形區域，然後蓋在舊圖形之上。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/217/Canvas_composite_srcatop.png" alt="Image:Canvas_composite_srcatop.png" class="internal"></p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>destination-atop</strong><br>
     舊圖形只保留在新、舊圖形重疊的舊圖形區域，然後蓋在新圖形之上。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/212/Canvas_composite_destatop.png" alt="Image:Canvas_composite_destatop.png" class="internal"></p>
   </td>
  </tr>
  <tr>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>lighter</strong><br>
     新舊圖形重疊區域的顏色，由新、舊圖形的顏色碼相加而得。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/216/Canvas_composite_lighten.png" alt="Image:Canvas_composite_lighten.png" class="internal"></p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>darker</strong> <span class="icon-only-inline" title="This is an obsolete API and is no longer guaranteed to work."><i class="icon-trash"> </i></span></p>

    <p>新舊圖形重疊區域的顏色，由新、舊圖形的顏色碼相減而得。此屬性值已經從畫布規格中移除了，不再支援。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/211/Canvas_composite_darken.png" alt="Image:Canvas_composite_darken.png" class="internal"></p>
   </td>
  </tr>
  <tr>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>xor</strong><br>
     新舊圖形重疊區域設為透明。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/221/Canvas_composite_xor.png" alt="Image:Canvas_composite_xor.png" class="internal"></p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><strong>copy</strong><br>
     移除其他圖形，只保留新圖形。</p>
   </td>
   <td style="padding: 5px; vertical-align: top;">
    <p><img src="https://mdn.mozillademos.org/files/210/Canvas_composite_copy.png" alt="Image:Canvas_composite_copy.png" class="internal"></p>
   </td>
  </tr>
 </tbody>
</table>

<p>這裡有這些構圖組合的<a href="/en-US/docs/Web/Guide/HTML/Canvas_tutorial/Compositing/Example" title="/en-US/docs/Web/Guide/HTML/Canvas_tutorial/Compositing/Example">實際範例</a>，<a href="https://mdn.mozillademos.org/en-US/docs/Web/Guide/HTML/Canvas_tutorial/Compositing/Example$samples/Compositing_example" title="https://mdn.mozillademos.org/en-US/docs/Web/Guide/HTML/Canvas_tutorial/Compositing/Example$samples/Compositing_example">輸出結果</a>在此。</p>

<h2 id="Clipping_paths" name="Clipping_paths">裁剪路徑</h2>

<p><img src="https://mdn.mozillademos.org/files/209/Canvas_clipping_path.png" alt style="float: right;" class="internal">裁剪路徑就像是一般畫布圖形繪圖，但就如同遮罩一樣，會蓋掉不需要的部分，如右圖所示。紅邊星星是我們的裁剪路徑，在路徑區域以外部分都不會出現在畫布上。</p>

<p>和上述 globalCompositeOperation 相比，可以發現 source-in 和 source-atop 這兩種構圖組合所達到的效果，和裁剪路徑類似，而其中最大差異在於裁剪路徑不需加入新圖形，消失的部分也不會出現在畫布上，所以，如果想要限定繪圖區域，裁剪路徑會是更理想的作法。</p>

<p>在<a href="/en-US/docs/Web/Guide/HTML/Canvas_tutorial/Drawing_shapes#Drawing_paths" title="Web/Guide/HTML/Canvas_tutorial/Drawing_shapes#Drawing_paths">繪畫圖形</a>一章中，我們只提到 stroke() 和 fill() 函式，但其實還有第三個函式，那就是 clip() 函式。</p>

<dl>
 <dt><code>clip()</code></dt>
 <dd>轉換目前繪圖路徑為裁剪路徑。</dd>
</dl>

<p>呼叫 clip() 除了會替代 closePath() 來關閉路徑之外，還會轉換目前填滿或勾勒繪圖路徑為裁剪路徑。</p>

<p> <a href="/zh-TW/docs/Web/HTML/Element/canvas" title="這個 HTML &lt;canvas&gt; 元素 可以被使用於對腳本程式(JaveScript) 繪圖 .舉例來說, 它能用來畫圖,組合照片,甚至作動畫. 你也許(應該) 在&lt;canvas&gt;區段內提供替代方案的內容 .這內容將能被一些不支援&lt;canvas&gt;以及無法使用Javescript功能的瀏覽器所渲染 ."><code>&lt;canvas&gt;</code></a> 畫布預設有一個等同於本身大小的裁剪路徑，等同於無裁剪效果。</p>

<h3 id="A_clip_example" name="A_clip_example"><code>clip</code> 範例</h3>

<p>本範例使用了圓形的裁剪路徑，來限定畫星星時的繪圖區域。</p>

<pre class="brush: js">function draw() {
  var ctx = document.getElementById(&apos;canvas&apos;).getContext(&apos;2d&apos;);
  ctx.fillRect(0,0,150,150);
  ctx.translate(75,75);

  // Create a circular clipping path
  ctx.beginPath();
  ctx.arc(0,0,60,0,Math.PI*2,true);
  ctx.clip();

  // draw background
  var lingrad = ctx.createLinearGradient(0,-75,0,75);
  lingrad.addColorStop(0, &apos;#232256&apos;);
  lingrad.addColorStop(1, &apos;#143778&apos;);

  ctx.fillStyle = lingrad;
  ctx.fillRect(-75,-75,150,150);

  // draw stars
  for (var j=1;j&lt;50;j++){
    ctx.save();
    ctx.fillStyle = &apos;#fff&apos;;
    ctx.translate(75-Math.floor(Math.random()*150),
                  75-Math.floor(Math.random()*150));
    drawStar(ctx,Math.floor(Math.random()*4)+2);
    ctx.restore();
  }

}

function drawStar(ctx,r){
  ctx.save();
  ctx.beginPath()
  ctx.moveTo(r,0);
  for (var i=0;i&lt;9;i++){
    ctx.rotate(Math.PI/5);
    if(i%2 == 0) {
      ctx.lineTo((r/0.525731)*0.200811,0);
    } else {
      ctx.lineTo(r,0);
    }
  }
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}
</pre>

<div class="hidden">
<pre class="brush: html">&lt;canvas id=&quot;canvas&quot; width=&quot;150&quot; height=&quot;150&quot;&gt;&lt;/canvas&gt;</pre>

<pre class="brush: js">draw();</pre>
</div>

<p>一開始我們先畫了一個黑色矩形作為畫布背景，然後移動畫布原點到中央，接著我們繪製弧線並呼叫 clip()，藉以建立圓形的裁剪路徑。畫布儲存狀態亦可儲存裁剪路徑。若要保留原本的裁剪路徑，則可於繪製新的裁剪路徑之前，先行儲存畫布狀態。</p>

<p>繪製裁剪路徑之後，所產生的所有圖形都只會出現在路徑以內，從後來繪製的漸層背景中可看出此特性。我們用自訂的 drawStar() 函數產生 50 個隨機散佈、大小不一的星星。這些星星同樣只會出現在裁剪路徑的範圍之內。</p>

<p></p><table class="sample-code-table"><thead><tr><th scope="col" style="text-align: center;">Screenshot</th><th scope="col" style="text-align: center;">Live sample</th></tr></thead><tbody><tr><td><img src="https://mdn.mozillademos.org/files/208/Canvas_clip.png" alt class="internal"></td><td><iframe src="https://mdn.mozillademos.org/zh-TW/docs/Web/API/Canvas_API/Tutorial/Compositing$samples/A_clip_example?revision=1155902" width="180" id="frame_A_clip_example" height="180" frameborder="0" class="live-sample-frame sample-code-frame"></iframe></td></tr></tbody></table><p></p>

<p></p><div style="text-align: right;" class="prevnext">
    <p><a style="float: left;" href="/zh-TW/docs/Web/Guide/HTML/Canvas_tutorial/Transformations" class="button">« 前頁</a><a href="/zh-TW/docs/Web/Guide/HTML/Canvas_tutorial/Basic_animations" class="button">次頁  »</a></p>
</div><p></p>
